import{j as t,B as v,a0 as _e,T as ve,v as Ue,ai as ze,w as Me,aj as Te,y as He,ak as Ke,al as We,am as Ge,I as qe}from"./mui-CyG7s_nf.js";import{r as c}from"./reactVendor-BAhb8EbJ.js";import{u as xe}from"./lang-DxTEvHWx.js";import{B as De}from"./B3Card-DBhg726O.js";import{bq as be,G as ke,C as Ce,k as he,a6 as ge,a8 as Se,br as $e,bm as Je,u as Ne,bs as Pe,a as Ie,W as fe,N as Ve,bt as Qe,a2 as Xe,a4 as Ye,ac as Ze,x as et}from"./react-setup-CTgvGe07.js";import{b as ue}from"./b3Logger-CMQiGC3f.js";import"../index.mqw90l6u.js";import{l as tt}from"./b3Login-BGWLvuqC.js";import{c as ot}from"./login-1iEirvU1.js";import{l as at}from"./config-B6rHvC5I.js";import{d as pe,t as nt,B as Fe,e as st,s as rt,b as it,g as Re,c as ct}from"./config-DNzSqtgM.js";import{n as lt}from"./eStyled-B3rIBjaz.js";import{u as Ee}from"./form-Bvi8lP6x.js";import{B as ye}from"./B3CustomForm-JX8vp-Z8.js";import{T as je,R as Ae,c as dt,s as ut,I as Be,v as mt,a as ft,b as pt,d as gt,e as ht}from"./RegisteredFinish-D7CZrov3.js";import{C as yt,g as xt}from"./recaptcha-DNQTSVaR.js";import{a as bt,c as Ft}from"./users-DNB6lQRR.js";import{i as Ct}from"./lodashEs-Ck10JMnh.js";import{u as It}from"./router-BbCjXwHs.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./muiIcon-BfPleEzf.js";import"./dateFns-BB2kaHor.js";import"./dropzone-D4lSiSJA.js";import"./validatorRules-CYVbp4Ts.js";function wt(Q){const B=xe(),{handleBack:k,activeStep:U,handleNext:G}=Q,[_,C]=c.useState([]),[P,z]=c.useState(""),[g,M]=c.useState(""),[J,X]=c.useState(""),[H,V]=c.useState(!1),[T,Z]=c.useState(""),[Y,ee]=c.useState(!1),I=m=>X(m);c.useEffect(()=>{(async()=>{try{const s=await xt();s&&(V(s.isEnabledOnStorefront),Z(s.siteKey))}catch(s){ue.error(s)}})()},[]),c.useEffect(()=>{J&&ee(!1)},[J]);const{control:ce,handleSubmit:ie,setError:te,formState:{errors:ne}}=Ee({mode:"all"}),{state:q,dispatch:O}=c.useContext(be),{state:{blockPendingAccountOrderCreation:K}}=c.useContext(ke),{state:{portalStyle:{backgroundColor:se="#FEF9F5"}}}=c.useContext(Ce),x=he(se),{contactInformation:N,bcContactInformation:E,passwordInformation:p=[],bcPasswordInformation:j=[],accountType:w,additionalInformation:oe,bcAdditionalInformation:le,addressBasicFields:D=[],bcAddressBasicFields:W=[],companyInformation:l=[],emailMarketingNewsletter:b}=q,h=w==="1"?N:E,$=w==="1"?p:j,R=w==="1"?oe:le,u=w==="1"?D:W;c.useEffect(()=>{if(w){if(h&&h.length){const m=h.find(s=>s.name==="email")||{};M((m==null?void 0:m.default)||"")}C($)}},[N,E,w,h,$]);const r=m=>{const s={};if(s.authentication={force_password_reset:!1,new_password:m.password},s.accepts_product_review_abandoned_cart_emails=b,h&&(h.forEach(o=>{var e;const d=pe(o.name);d==="accepts_marketing_emails"?s.accepts_product_review_abandoned_cart_emails=!!((e=o==null?void 0:o.default)!=null&&e.length):o.custom||(s[d]=(o==null?void 0:o.default)||"")}),s.form_fields=[],R&&R.length&&R.forEach(o=>{s.form_fields.push({name:o.bcLabel,value:o.default})})),s.addresses=[],s.origin_channel_id=ge,s.channel_ids=[ge],w==="2"){const o={},d=u.filter(n=>!n.custom),e=u.filter(n=>n.custom);d&&(s.addresses={},d.forEach(n=>{n.name==="country"?o.country_code=n.default:n.name==="state"?o.state_or_province=n.default:n.name==="postalCode"?o.postal_code=n.default:n.name==="firstName"?o.first_name=n.default:n.name==="lastName"?o.last_name=n.default:o[n.name]=n.default})),o.form_fields=[],e&&e.length&&e.forEach(n=>{o.form_fields.push({name:n.bcLabel,value:n.default})}),s.addresses=[o],s.trigger_account_created_notification=!0}const A={storeHash:Se,...s};return dt(A)},y=async(m,s,A)=>{try{const o={};o.customerId=s||"",o.storeHash=Se;const e=(h||[]).filter(a=>!!a.custom);if(e.length){const a=[];e.forEach(f=>{const S={};S.fieldName=pe(f.name),S.fieldValue=(f==null?void 0:f.default)||"",a.push(S)}),o.userExtraFields=a}const n=l.filter(a=>!a.custom&&a.fieldType!=="files"),i=l.filter(a=>!!a.custom);if(n.length&&n.forEach(a=>{o[nt(pe(a.name))]=(a==null?void 0:a.default)||""}),i.length){const a=[];i.forEach(f=>{const S={};S.fieldName=pe(f.name),S.fieldValue=(f==null?void 0:f.default)||"",a.push(S)}),o.extraFields=a}const F=u.filter(a=>!a.custom)||[],L=u.filter(a=>!!a.custom)||[];if(F.length&&F.forEach(a=>{const f=pe(a.name);f==="address1"&&(o.addressLine1=a.default),f==="address2"&&(o.addressLine2=a.default),o[f]=a.default}),L.length){const a=[];L.forEach(f=>{const S={};S.fieldName=pe(f.name),S.fieldValue=(f==null?void 0:f.default)||"",a.push(S)}),o.addressExtraFields=a}return o.fileList=A,o.channelId=ge,await $e(o)}catch(o){ue.error(o)}},ae=async m=>{let s=[];if(m.length){m.forEach(A=>{s=A.default});try{return(await Promise.all(s.map(d=>Je({file:d,type:"companyAttachedFile"})))).reduce((d,e)=>{let n=d;if(e.code===200){const i={...e.data};i.fileSize=i.fileSize?"".concat(i.fileSize):"",n=[...d,i]}else throw e.data.errMsg||e.message||B("intl.global.fileUpload.fileUploadFailure");return n},[])}catch(A){throw ue.error(A),A}}},re=m=>{const s=p.map(o=>{const d=o;return w==="1"&&(d.default=m[o.name]||o.default),o}),A=j.map(o=>{const d=o;return w==="2"&&(d.default=m[o.name]||o.default),o});O({type:"all",payload:{passwordInformation:s,bcPasswordInformation:A}})},de=async()=>{if(h&&h.length>0){const m=h.find(e=>e.fieldId==="field_email_marketing_newsletter"&&e.fieldType==="checkbox"),s=h.find(e=>e.fieldId==="field_first_name")||{},A=h.find(e=>e.fieldId==="field_last_name")||{},o=(m==null?void 0:m.isChecked)||!1,d=(m==null?void 0:m.default)||[];if(o&&d.length>0)try{await ut({storeHash:Se,email:g,first_name:s.default,last_name:A.default,channel_id:ge||1})}catch(e){z((e==null?void 0:e.message)||e)}}},me=m=>{ie(async s=>{var A,o;if(s.password!==s.confirmPassword){te("confirmPassword",{type:"manual",message:B("global.registerComplete.passwordMatchPrompt")}),te("password",{type:"manual",message:B("global.registerComplete.passwordMatchPrompt")});return}if(H&&!J){ee(!0);return}if(!Y)try{O({type:"loading",payload:{isLoading:!0}});let d=!0;if(w==="2")await r(s);else{const e=l.filter(f=>f.fieldType==="files"),n=await ae(e||[]),i=await r(s),{data:F}=i,L=await y(s,F.id,n);d=+(((o=(A=L==null?void 0:L.companyCreate)==null?void 0:A.company)==null?void 0:o.companyStatus)||"")==1}O({type:"finishInfo",payload:{submitSuccess:!0,isAutoApproval:d,blockPendingAccountOrderCreation:K}}),re(s),await de(),G()}catch(d){z((d==null?void 0:d.message)||d)}finally{O({type:"loading",payload:{isLoading:!1}})}})(m)};return t.jsxs(v,{sx:{pl:1,pr:1,mt:2,width:"100%","& h4":{color:x},"& input, & .MuiFormControl-root .MuiTextField-root":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",padding:"10px !important"}},children:[P&&t.jsx(_e,{severity:"error",children:t.jsx(je,{children:P})}),t.jsxs(v,{children:[_&&t.jsxs(t.Fragment,{children:[g.length>0&&t.jsx(v,{sx:{fontSize:"16px",fontWeight:400,color:"#000000",marginBottom:"10px",marginTop:"-12px",wordWrap:"break-word",textAlign:"center"},children:"Ahora por favor crea una contraseÃ±a para tu cuenta: ".concat(g)}),t.jsx(ye,{formFields:_,errors:ne,control:ce})]}),Y?t.jsx(ve,{variant:"body1",sx:{display:"flex",alignSelf:"flex-start",marginLeft:"8px",marginTop:"2px",fontSize:"13px"},children:B("login.loginText.missingCaptcha")}):"",H?t.jsx(v,{sx:{display:"flex",justifyContent:"center",marginTop:"20px"},children:t.jsx(yt,{siteKey:T,size:"normal",handleGetKey:I})}):""]}),t.jsx(Ae,{handleBack:k,activeStep:U,handleNext:me,email:g})]})}function St(Q){var D,W;const{handleBack:B,handleNext:k,activeStep:U}=Q,{state:G,dispatch:_}=c.useContext(be),C=Ne(Pe),{state:{accountLoginRegistration:P,portalStyle:{backgroundColor:z="#FEF9F5"}}}=c.useContext(Ce),g=he(z),M=xe(),[J]=Ie(),[X,H]=c.useState(""),{contactInformation:V,accountType:T,additionalInformation:Z,bcContactInformation:Y,bcAdditionalInformation:ee}=G,{control:I,handleSubmit:ce,getValues:ie,formState:{errors:te},setError:ne,setValue:q}=Ee({mode:"onSubmit"}),O=T==="1"?"additionalInformation":"bcAdditionalInformation",K=T==="1"?Z||[]:ee||[],se=V==null?void 0:V.map(l=>{const b=l;return l.fieldId==="field_email"&&T==="1"&&(b.isTip=!1),l}),x=T==="1"?se:Y||[],N=T==="1"?"contactInformation":"bcContactInformationFields",E=K.length?(D=K[0])==null?void 0:D.groupName:"",p=(l=!1)=>{_({type:"loading",payload:{isLoading:l}})},j=l=>{_({type:"accountType",payload:{accountType:l.target.value}})},w=((W=V==null?void 0:V.find(l=>l.fieldId==="field_email"))==null?void 0:W.name)||"email",oe=async l=>{const b=T==="1";try{p(!0);const{isValid:h,userType:$,userInfo:{companyName:R=""}={}}=b?await bt({email:l,channelId:ge}):await Ft({email:l,channelId:ge});return h?H(""):(H(M(st[$],{companyName:R||"",email:l})),ne(w,{type:"custom",message:""}),C==null||C.body.scrollIntoView(!0)),h}catch(h){return!1}finally{p(!1)}},le=async l=>{ce(async b=>{var R;if(!await oe(b[w]))return;const h=x.map(u=>{const r=u;return r.default=b[u.name]||u.default,u.fieldId==="field_email_marketing_newsletter"&&u.fieldType==="checkbox"&&(r.isChecked=b[u.name].length>0),u});try{if(p(!0),T==="1"){const u=h.filter(y=>!!y.custom),r=u.map(y=>({fieldName:Fe.decode(y.name),fieldValue:b[y.name]||y.default}));if(r.length>0){const y=await mt({extraFields:r});if(y.code!==200){const ae=((R=y.data)==null?void 0:R.errMsg)||y.message||"",re=ae.split(":");if(re.length>=2){const de=u.find(me=>Fe.decode(me.name)===re[0]);if(de){ne(de.name,{type:"manual",message:re[1]}),p(!1);return}}H(ae),p(!1);return}}H("")}}catch(u){ue.error(u)}finally{p(!1)}let $=[];K&&($=K.map(u=>{const r=u;return r.default=b[u.name]||u.default,u})),_({type:"all",payload:{[O]:[...$],[N]:[...h]}}),k()})(l)};return t.jsxs(v,{sx:{pl:1,pr:1,mt:2,width:"100%"},children:[X&&t.jsx(_e,{severity:"error",children:t.jsx(je,{children:X})}),t.jsx(v,{component:"div",sx:{color:"#000000",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:J?"0.875rem":"1rem",textAlign:J?"center":"center ",padding:"0px 15px"},dangerouslySetInnerHTML:{__html:M("register.step.account.customText")}}),t.jsx(Ue,{sx:{"& h4":{color:g}},children:t.jsxs(ze,{"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",value:T,onChange:j,sx:{display:"none","& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label":{color:fe(g,.87)},"& .MuiButtonBase-root.MuiRadio-root.MuiRadio-colorPrimary:not(.Mui-checked)":{color:fe(g,.6)}},children:[P.b2b&&t.jsx(Me,{value:"1",control:t.jsx(Te,{}),label:M("register.registeredAccount.businessAccount")}),P.b2c&&t.jsx(Me,{value:"2",control:t.jsx(Te,{}),label:M("register.registeredAccount.personalAccount")})]})}),t.jsx(v,{sx:{"& h4":{color:g},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",padding:"10px !important"},"& .MuiButtonBase-root.MuiCheckbox-root.MuiCheckbox-colorPrimary:not(.Mui-checked)":{color:fe(g,.6)},"& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label":{color:fe(g,.87)}},children:t.jsx(ye,{formFields:x,errors:te,control:I,getValues:ie,setValue:q})}),t.jsx(v,{}),K&&K.length?t.jsxs(v,{sx:{"& h4":{color:g},"& .MuiFormControlLabel-label, & .MuiFormControl-root .MuiFormLabel-root:not(.Mui-focused)":{color:fe(g,.87)},"& .MuiRadio-root:not(.Mui-checked)":{color:fe(g,.6)}},children:[t.jsx(Be,{children:E}),t.jsx(ye,{formFields:K,errors:te,control:I,getValues:ie,setValue:q})]}):"",t.jsx(Ae,{activeStep:U,handleBack:B,handleNext:le})]})}function Bt(Q){var de,me,m,s,A,o,d;const B=xe(),[k]=Ie(),{handleBack:U,handleNext:G,activeStep:_}=Q,{state:C,dispatch:P}=c.useContext(be),z=C.contactInformation||[],g=C.companyInformation||[],M=((de=z.find(e=>e.fieldId==="field_first_name"))==null?void 0:de.default)||"",J=((me=z.find(e=>e.fieldId==="field_last_name"))==null?void 0:me.default)||"",X="".concat(M," ").concat(J).trim(),H=g.find(e=>e.fieldId==="field_company_name");H&&(H.default=X);const V=((m=z.find(e=>e.fieldId==="field_email"))==null?void 0:m.default)||"",T=g.find(e=>e.fieldId==="field_company_email");T&&(T.default=V);const Z=((s=z.find(e=>e.fieldId==="field_phone_number"))==null?void 0:s.default)||"",Y=g.find(e=>e.fieldId==="field_company_phone_number");Y&&(Y.default=Z);const ee=((A=z.find(e=>e.label==="CÃ©dula profesional"))==null?void 0:A.default)||"",I=g.find(e=>e.label==="CÃ©dula profesional");I&&(I.default=ee);const{state:{portalStyle:{backgroundColor:ce="#FEF9F5"}}}=c.useContext(Ce),ie=he(ce),[te,ne]=c.useState(""),{accountType:q="1",companyInformation:O=[],companyAttachment:K=[],addressBasicFields:se=[],bcAddressBasicFields:x=[],countryList:N=[]}=C,{control:E,handleSubmit:p,getValues:j,formState:{errors:w},setValue:oe,watch:le,setError:D}=Ee({mode:"all"}),W=q==="1"?(o=O[0])==null?void 0:o.groupName:"",l=q==="1"?"addressBasicFields":"bcAddressBasicFields",b=q==="1"?se:x,h=((d=b[0])==null?void 0:d.groupName)||"",$=c.useCallback((e,n="")=>{var L;const i=((L=N.find(a=>a.countryCode===e||a.countryName===e))==null?void 0:L.states)||[],F=b.find(a=>a.name==="state");F&&(i.length>0?(F.fieldType="dropdown",F.options=i):(F.fieldType="text",F.options=[])),oe("state",n&&e&&(i.find(a=>a.stateName===n)||i.length===0)?n:""),P({type:"stateList",payload:{stateList:i,addressBasicFields:se,bcAddressBasicFields:x,[l]:[...b]}})},[se,b,l,x,N]);c.useEffect(()=>{const e=j("country"),n=j("state");$(e,n)},[]),c.useEffect(()=>{const e=le((n,{name:i,type:F})=>{const{country:L,state:a}=n;i==="country"&&F==="change"&&$(L,a)});return()=>e.unsubscribe()},[N,$]);const R=(e=!1)=>{P({type:"loading",payload:{isLoading:e}})},u=(e,n)=>e.map(i=>{const F=i;return F.default=n[i.name]||i.default,i}),r=()=>{const e=[...O,...K,...b].reduce((L,a)=>{const f=L;return f[a.name]=j(a.name)||a.default,L},{}),n=u(O,e),i=u(K,e),F=u(b,e);P({type:"all",payload:{companyInformation:[...n],companyAttachment:[...i],[l]:[...F]}})},y=()=>{var e;if(q==="1"){const n=j(),i=O.find(F=>F.fieldId==="field_attachments");if(!Ct(i)&&i.required&&n[i.name].length===0)return D(i.name,{type:"required",message:B("global.validate.required",{label:(e=i.label)!=null?e:""})}),R(!1),!0}return!1},ae=e=>{const n=y();p(async i=>{var F;if(!n){R(!0);try{if(q==="1"){const L=O.filter(S=>!!S.custom),a=L.map(S=>({fieldName:Fe.decode(S.name),fieldValue:i[S.name]||S.default})),f=await ft({extraFields:a});if(f.code!==200){const S=((F=f.data)==null?void 0:F.errMsg)||f.message||"",we=S.split(":");if(we.length>=2){const Le=L.find(Oe=>Fe.decode(Oe.name)===we[0]);if(Le){D(Le.name,{type:"manual",message:we[1]}),R(!1);return}}ne(S),R(!1);return}ne("")}r(),R(!1),G()}catch(L){R(!1)}}})(e)},re=()=>{r(),U()};return t.jsxs(v,{sx:{pl:1,pr:1,mt:2,width:"100%","& h4":{color:ie},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiDropzoneArea-textContainer, & .MuiSelect-select.MuiSelect-outlined, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",padding:"10px !important"}},children:[te&&t.jsx(_e,{severity:"error",children:t.jsx(je,{children:te})}),t.jsx(v,{component:"div",sx:{color:"#000000",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:k?"0.875rem":"1rem",textAlign:k?"center":"center ",padding:"0px 15px"},dangerouslySetInnerHTML:{__html:B("register.step.details.customText")}}),q==="1"?t.jsxs(v,{sx:{display:"none !important"},children:[t.jsx(Be,{children:W}),t.jsx(ye,{formFields:[...O],errors:w,control:E,getValues:j,setValue:oe,setError:D})]}):null,t.jsxs(v,{children:[t.jsx(Be,{children:h}),t.jsx(ye,{formFields:b,errors:w,control:E,getValues:j,setValue:oe})]}),t.jsx(Ae,{handleBack:re,handleNext:ae,activeStep:_})]})}const _t=lt(v)({"& #b3-customForm-id-name":{'& label[data-shrink="true"]':{whiteSpace:"break-spaces",transition:"unset",background:"white"},'& label[data-shrink="false"]':{whiteSpace:"break-spaces",color:"#474747",fontFamily:"Montserrat",fontSize:"0.9375rem",fontStyle:"normal",fontWeight:400,lineHeight:"normal",top:"-4px",background:"white"}}});function Et(Q){const{activeStep:B,handleBack:k,handleNext:U,handleFinish:G}=Q,_=C=>{switch(C){case 0:return t.jsx(St,{activeStep:B,handleBack:k,handleNext:U});case 1:return t.jsx(Bt,{activeStep:B,handleBack:k,handleNext:U});case 2:return t.jsx(wt,{activeStep:B,handleBack:k,handleNext:U});case 3:return t.jsx(pt,{activeStep:B,handleFinish:G});default:return null}};return t.jsx(_t,{component:"div",children:_(B)})}function jt(Q){const{children:B,isStepOptional:k,activeStep:U,backgroundColor:G}=Q,_=xe(),[C]=Ie(),P=He(),{state:z}=c.useContext(be),{accountType:g,submitSuccess:M,isAutoApproval:J}=z,X=Ve.get("blockPendingAccountOrderCreation")&&!J,H=_(X?"register.title.registerCompleteWarning":"register.title.registerComplete"),V=g==="1"?H:_("register.title.accountCreated"),T=he(G);return c.useEffect(()=>{M&&(console.log("User registered"),console.log(M),window.parent.postMessage({method:"postMessageB2BRegister",data:{type:"TRACK_COMPLETE_REGISTRATION"}},"*"))},[M]),t.jsxs(v,{component:"div",sx:{borderRadius:"4px",marginTop:"3px",background:"#FFFFFF",width:"100%",padding:C?"0 20px":"0 20%"},children:[t.jsx(v,{component:"h3",sx:{color:"#474747",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:C?"1.625rem":"2.5rem",textAlign:C?"center":"center "},children:M?V:_("register.title.accountRegister")}),!M&&t.jsx(Ke,{activeStep:U,sx:{display:"none","& .MuiSvgIcon-root:not(.Mui-active) .MuiStepIcon-text":{fill:he(T)},"& .MuiSvgIcon-root.Mui-active .MuiStepIcon-text":{fill:he(P.palette.primary.main)}},children:rt.map((Z,Y)=>{const ee={},I={};return k(Y)&&(I.optional=t.jsx(ve,{variant:"caption",children:_("register.step.optional")})),t.jsx(We,{...ee,children:t.jsx(Ge,{...I,children:_(Z)})},Z)})}),B]})}const At=[1,2];function no(Q){const{setOpenPage:B}=Q,[k,U]=c.useState(0),G=xe(),[_]=Ie(),C=It(),P=Ne(Pe),{state:{isCheckout:z,isCloseGotoBCHome:g,logo:M,storeName:J,registerEnabled:X}}=c.useContext(ke),{state:{isLoading:H,accountType:V,contactInformation:T=[],passwordInformation:Z=[],bcPasswordInformation:Y=[],bcContactInformation:ee=[]},dispatch:I}=c.useContext(be),{state:{accountLoginRegistration:ce,portalStyle:{backgroundColor:ie="#FEF9F5"}}}=c.useContext(Ce);c.useEffect(()=>{X||C("/login")},[X]),c.useEffect(()=>{(async()=>{var N,E,p,j;try{I&&(I({type:"loading",payload:{isLoading:!0}}),I({type:"finishInfo",payload:{submitSuccess:!1}}));const w=At.map(r=>Ye(r)),oe=await Promise.all(w),le=(((N=oe[1])==null?void 0:N.accountFormFields)||[]).map(r=>{const y=r;return it.includes((r==null?void 0:r.fieldId)||"")&&r.groupId===4&&(y.isRequired=!0,y.visible=!0),r}),D=Re(((E=oe[0])==null?void 0:E.accountFormFields)||[]),W=Re(le||[]),{countries:l}=await Ze(),b=((p=W.address)==null?void 0:p.map(r=>{const y=r;return r.name==="country"&&(y.options=l,y.replaceOptions={label:"countryName",value:"countryName"}),r}))||[],h=((j=D.address)==null?void 0:j.map(r=>{const y=r;if(r.name==="country"){y.options=l;const ae=l.find(re=>re.countryName===r.default);y.default=(ae==null?void 0:ae.countryCode)||r.default}return r}))||[],{b2b:$,b2c:R}=ce;I&&I({type:"all",payload:{accountType:R&&!$?"2":"1",isLoading:!1,storeName:J,contactInformation:[...W.contactInformation||[]],bcContactInformation:[...D.contactInformation||[]],additionalInformation:[...W.additionalInformation||[]],bcAdditionalInformation:[...D.additionalInformation||[]],companyExtraFields:[],companyInformation:[...(W==null?void 0:W.businessDetails)||[]],companyAttachment:[...ct(G)],addressBasicFields:[...b],bcAddressBasicFields:[...h],countryList:[...l],passwordInformation:[...W.password||[]],bcPasswordInformation:[...D.password||[]]}})}catch(w){ue.error(w)}})()},[]);const te=x=>x===-1,ne=()=>{var E,p;const x=((E=(V==="1"?T:ee).find(j=>j.name==="email"))==null?void 0:E.default)||"",N=((p=(V==="1"?Z:Y).find(j=>j.name==="password"))==null?void 0:p.default)||"";return{emailAddress:x,password:N}},q=async()=>{U(x=>x+1)},O=()=>{U(x=>x-1)},K=()=>{I&&I({type:"all",payload:{accountType:"",isLoading:!1,storeName:"",submitSuccess:!1,contactInformation:[],additionalInformation:[],companyExtraFields:[],companyInformation:[],companyAttachment:[],addressBasicFields:[],addressExtraFields:[],countryList:[],passwordInformation:[]}})},se=async()=>{var N;I({type:"loading",payload:{isLoading:!0}});const x=ne();if(z)try{await at(x),window.location.reload()}catch(E){ue.error(E)}else try{const E={email:x.emailAddress,pass:x.password},{data:p}=await ot(E);if((N=p==null?void 0:p.login)!=null&&N.customer&&Ve.set("loginCustomer",{emailAddress:p.login.customer.email,phoneNumber:p.login.customer.phone,...p.login.customer}),await et(),K(),!tt(C))return;g?window.location.href="/":C("/orders")}catch(E){ue.error(E)}I({type:"loading",payload:{isLoading:!1}})};return c.useEffect(()=>{P==null||P.body.scrollIntoView(!0)},[k]),Qe(!1),t.jsx(De,{setOpenPage:B,children:t.jsx(gt,{isMobile:_,children:t.jsx(Xe,{isSpinning:H,tip:G("global.tips.loading"),transparency:"0",children:t.jsxs(v,{sx:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center"},children:[M&&t.jsx(ht,{children:t.jsx(qe,{sx:{maxWidth:"250px"},onClick:()=>{window.location.href="/"},children:t.jsx("img",{src:"".concat(M),alt:G("global.tips.registerLogo"),loading:"lazy"})})}),t.jsx(jt,{activeStep:k,isStepOptional:te,backgroundColor:ie,children:t.jsx(Et,{activeStep:k,handleBack:O,handleNext:q,handleFinish:se})})]})})})})}export{no as default};
