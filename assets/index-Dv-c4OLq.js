import{s as Ze,W as et,j as e,q as tt,X as G,G as te,B as p,T as w,e as ue,K as Ce,ab as we,g as Se,ad as Ie}from"./mui-CyG7s_nf.js";import{r as u}from"./reactVendor-BAhb8EbJ.js";import{u as W}from"./lang-CO9rnotr.js";import{c as ge}from"./lodashEs-Ck10JMnh.js";import{u as M,R as ke,a5 as Z,a as oe,ai as Y,a9 as nt,_ as Ae,a2 as se,aj as Be,ak as K,al as pe,am as ne,an as ot,G as st,ab as it,ao as be}from"./react-setup-DmRjJMtp.js";import"../index.CVSTvWZ2.js";import{b as ce}from"./b3Logger-CMQiGC3f.js";import{i as rt,g as Pe,a as at,b as ct,e as lt,c as dt,d as ut}from"./payment-0o50ghZ0.js";import{u as pt}from"./useSort-Cu2YrCwH.js";import{B as xt}from"./B3Filter-B9af3IIC.js";import{d as ft}from"./MoreHoriz-CpUEKbCq.js";import{u as ie,a as mt}from"./router-BbCjXwHs.js";import{R as ht}from"./resizable-CsQNktwD.js";import{P as yt}from"./pdfobject-BVlZ-mQx.js";import{n as gt}from"./eStyled-B3rIBjaz.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./muiIcon-BfPleEzf.js";import"./dateFns-BB2kaHor.js";import"./dropzone-D4lSiSJA.js";import"./b3checkout-3OfgsuNa.js";import"./B3FilterMore-BzJZeh8t.js";import"./form-Bvi8lP6x.js";import"./B3CustomForm-D63ourZ6.js";import"./B3FilterSearch-CoPczzeJ.js";const bt=r=>new Promise((n,o)=>{fetch(r).then(a=>a.blob()).then(a=>{const x=new Blob([a],{type:"application/pdf"}),b=window.URL.createObjectURL(x);n(b)}).catch(a=>{o(a)})}),De=async(r,n=!1)=>{const{invoicePdf:{url:o}}=await rt(+r,n);return o},xe=async(r,n=!1)=>{let o="";try{return o=await De(r,n),await bt(o)}catch(a){return o}},vt=Ze(et)(()=>({"& .MuiPaper-elevation":{boxShadow:"0px 1px 0px -1px rgba(0, 0, 0, 0.1), 0px 1px 6px rgba(0, 0, 0, 0.07), 0px 1px 4px rgba(0, 0, 0, 0.06)",borderRadius:"4px"}}));function Fe({row:r,setIsRequestLoading:n,setInvoiceId:o,handleOpenHistoryModal:a}){const x=M(({global:d})=>d.storeInfo.platform),b=u.useRef(null),[y,m]=u.useState(!1),[D,v]=u.useState(!0),S=ie(),h=W(),{getOrderPermission:A,invoicePayPermission:k,purchasabilityPermission:T}=M(ke),L=()=>{m(!1)},E=()=>{const{id:d}=r;o(d),m(!0)},O=async d=>{const{id:P}=r;L(),n(!0);const C=await xe(P,d);if(n(!1),!C){Z.error("pdf url resolution error");return}const{href:$}=window.location;$.includes("invoice")&&window.open(C,"_blank","fullscreen=yes")},R=()=>{const{orderNumber:d}=r;L(),S("/orderDetail/".concat(d))},B=async()=>{L();const{openBalance:d,originalBalance:P,id:C}=r,$={lineItems:[{invoiceId:+C,amount:d.value==="."?"0":"".concat(+d.value)}],currency:(d==null?void 0:d.code)||P.code};if(d.value==="."||+d.value==0){Z.error("The payment amount entered has an invalid value.",{isClose:!0});return}await Pe($,x,!1)},V=async()=>{L(),a(!0)},X=async()=>{const{id:d}=r;L(),n(!0);const P=await De(d);n(!1);const C=document.createElement("a");C.href=P,C.target="_blank",C.download="file.pdf",C.click()};return u.useEffect(()=>{const{openBalance:d}=r,P=+d.value>0&&k&&T;v(P)},[]),e.jsxs(e.Fragment,{children:[e.jsx(tt,{onClick:E,ref:b,children:e.jsx(ft,{})}),e.jsxs(vt,{id:"basic-menu",anchorEl:b.current,open:y,onClose:L,MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsx(G,{sx:{color:"primary.main"},onClick:()=>O(r.status!==2&&k&&T),children:h("invoice.actions.viewInvoice")},"View-invoice"),A&&e.jsx(G,{sx:{color:"primary.main"},onClick:R,children:h("invoice.actions.viewOrder")},"View-Order"),r.status!==0&&e.jsx(G,{sx:{color:"primary.main"},onClick:V,children:h("invoice.actions.viewPaymentHistory")},"View-payment-history"),D&&e.jsx(G,{sx:{color:"primary.main"},onClick:B,children:h("invoice.actions.pay")},"Pay"),e.jsx(G,{sx:{color:"primary.main"},onClick:()=>O(r.status!==2&&k&&T),children:h("invoice.actions.print")},"Print"),e.jsx(G,{sx:{color:"primary.main"},onClick:()=>X(),children:h("invoice.actions.download")},"Download")]})]})}function jt(r){const n=M(({global:k})=>k.storeInfo.platform),o=W(),[a]=oe(),[x,b]=u.useState(0),[y,m]=u.useState("$"),D=M(({b2bFeatures:k})=>k.masqueradeCompany.isAgenting),v=a?{alignItems:"flex-start",flexDirection:"column"}:{alignItems:"center"},{selectedPay:S,decimalPlaces:h}=r,A=async()=>{const k=[];let T="SGD";if(S.length>0){if(S.forEach(O=>{const{node:{id:R,openBalance:B,originalBalance:V}}=O;k.push({invoiceId:+R,amount:B.originValue==="."?"0":"".concat(+B.originValue)}),T=(B==null?void 0:B.code)||V.code}),k.find(O=>O.amount==="."||+O.amount==0)){Z.error(o("invoice.footer.invalidNameError"),{isClose:!0});return}await Pe({lineItems:k,currency:T},n,!1)}};return u.useEffect(()=>{if(S.length>0){const k=E=>{let O=0;E.forEach(R=>{const{node:{openBalance:B}}=R;O+=B.originValue==="."?0:+B.originValue}),b(O.toFixed(h))},{node:{openBalance:T}}=S[0],L=Y(T.code);m(L),k(S)}},[h,S]),e.jsxs(te,{sx:{position:"fixed",bottom:a&&D?"52px":0,left:0,backgroundColor:"#fff",width:"100%",padding:a?"0 0 1rem 0":"0 40px 1rem 40px",height:a?"8rem":"auto",marginLeft:0,display:"flex",flexWrap:"nowrap",zIndex:"999"},container:!0,spacing:2,children:[e.jsx(te,{item:!0,sx:{display:a?"none":"block",width:"290px",paddingLeft:"20px"}}),e.jsx(te,{item:!0,sx:a?{flexBasis:"100%"}:{flexBasis:"690px",flexGrow:1},children:e.jsxs(p,{sx:{width:"100%",pr:"20px",display:"flex",zIndex:"999",justifyContent:"space-between",...v},children:[e.jsx(w,{sx:{color:"#000000",fontSize:"16px",fontWeight:"400"},children:o("invoice.footer.invoiceSelected",{invoices:S.length})}),e.jsxs(p,{sx:{display:"flex",alignItems:"center",flexWrap:a?"wrap":"nowrap",width:a?"100%":"auto"},children:[e.jsx(w,{variant:"h6",sx:{fontSize:"16px",fontWeight:"700",color:"#000000"},children:o("invoice.footer.totalPayment",{total:"".concat(y).concat(x)})}),e.jsx(p,{sx:{display:"flex",alignItems:"center",marginTop:a?"0.5rem":0,width:a?"100%":"auto"},children:e.jsx(ue,{variant:"contained",sx:{marginLeft:a?0:"1rem",width:a?"100%":"auto"},onClick:()=>{A()},children:o("invoice.footer.payInvoices")})})]})]})}),e.jsx(te,{item:!0,sx:a?{flexBasis:"100%",display:a?"none":"block"}:{flexBasis:"0",display:a?"none":"block"}})]})}function Te(r){const{code:n}=r,a=(x=>({0:{textColor:"#000000",name:"Open",color:"#F1C224"},1:{textColor:"#FFFFFF",name:"Partially paid",color:"#516FAE"},2:{textColor:"#FFFFFF",name:"Paid",color:"#EA617C"},3:{textColor:"#FFFFFF",name:"Overdue",color:"#D32F2F"}})[x]||{})(n);return a.name?e.jsx(nt,{color:a.color,textColor:a.textColor,children:a.name}):null}function Q({title:r}){return e.jsxs(w,{sx:{fontWeight:"bold",pr:"5px"},children:[r,":"]})}function Ct({list:r}){return e.jsx(e.Fragment,{children:r.map(n=>{const{node:{createdAt:o,amount:a,paymentType:x,transactionType:b,referenceNumber:y,id:m}}=n;return e.jsx(Ce,{sx:{mb:"10px"},children:e.jsxs(we,{sx:{color:"#313440",wordBreak:"break-word",display:"flex",flexDirection:"column",justifyContent:"space-around"},children:[e.jsxs(p,{sx:{display:"flex"},children:[e.jsx(Q,{title:"Date received"}),e.jsx(w,{variant:"body1",children:"".concat(K(+o))})]}),e.jsxs(p,{sx:{display:"flex"},children:[e.jsx(Q,{title:"Amount"}),e.jsx(w,{variant:"body1",children:"".concat(pe(a.code,+((a==null?void 0:a.value)||0)))})]}),e.jsxs(p,{sx:{display:"flex"},children:[e.jsx(Q,{title:"Transaction type"}),e.jsx(w,{variant:"body1",children:b})]}),e.jsxs(p,{sx:{display:"flex"},children:[e.jsx(Q,{title:"Payment type"}),e.jsx(w,{variant:"body1",children:x})]}),e.jsxs(p,{sx:{display:"flex"},children:[e.jsx(Q,{title:"Reference"}),e.jsx(w,{variant:"body1",children:y||"–"})]})]})},m)})})}function wt({open:r,setOpen:n,currentInvoiceId:o}){const a=W(),[x]=oe(),[b,y]=u.useState(!1),[m,D]=u.useState([]);return u.useEffect(()=>{r&&o&&(async()=>{y(!0);const{allReceiptLines:{edges:S=[]}}=await at(+o);D(S),y(!1)})()},[r,o]),e.jsx(Ae,{isOpen:r,leftSizeBtn:"",rightSizeBtn:"ok",title:a("invoice.paymentHistory.title"),showLeftBtn:!1,handRightClick:()=>n(!1),children:e.jsx(p,{sx:{width:x?"100%":"384px",maxHeight:"600px"},children:e.jsx(se,{isSpinning:b,children:e.jsx(p,{sx:{display:"flex",flexDirection:"column",flex:1},children:m.length?e.jsx(Ct,{list:m}):e.jsx(Be,{})})})})})}const U={NORMAL:"normal",DETAIL:"detail",CHECKOUT:"checkout"},St=[{key:"open",value:0,label:"Open"},{key:"partialPaid",value:1,label:"Partially paid"},{key:"paid",value:2,label:"Paid"},{key:"overdue",value:3,label:"Overdue"}],It=[{name:"status",label:"Status",required:!1,default:"",fieldType:"dropdown",xs:12,variant:"outlined",size:"small",options:St}],ve={status:"invoice.filterStatus.title",open:"invoice.filterStatus.open",partialPaid:"invoice.filterStatus.partiallyPaid",paid:"invoice.filterStatus.paid",overdue:"invoice.filterStatus.overdue"},Le="id",Oe={id:"invoiceNumber",orderNumber:"orderNumber",createdAt:"createdAt",updatedAt:"dueDate",originalBalance:"originalBalanceAmount",openBalance:"openBalanceAmount",status:"status"},je={invoiceNumber:"invoice_number",orderNumber:"order_number",createdAt:"created_at",dueDate:"due_date",originalBalanceAmount:"original_balance_amount",openBalanceAmount:"open_balance_amount"};function de({title:r,withColon:n=!0}){return e.jsx(w,{sx:{fontWeight:"bold",pr:"5px"},children:n?"".concat(r,":"):r})}function kt({isRow:r=!0,type:n="",value:o,label:a,code:x}){const b=()=>{if(n==="time")return K(+o)||"";if(n==="currency"){const y=+(o||0);return pe(x,y)}if(n==="paymentType"){let y="".concat(o).trim();return o&&(y=y.slice(0,1).toUpperCase()+y.slice(1).toLowerCase()),y}return o||"–"};return e.jsxs(p,{sx:{display:"flex",flexDirection:r?"row":"column"},children:[e.jsx(de,{title:a}),e.jsx(w,{variant:"body1",children:"".concat(b())})]})}function At({list:r}){var y;const{receiptLineSet:{edges:n=[]},details:o}=r,a=((y=o==null?void 0:o.paymentDetails)==null?void 0:y.comment)||"",x=W(),b=[{key:"paymentId",label:"Payment#",type:"",isRow:!0,idLang:"payment.paymentNumber"},{key:"createdAt",label:"Payment received on",type:"time",isRow:!0,idLang:"payment.paymentReceivedOn"},{key:"transactionType",label:"Transaction type",type:"",isRow:!0,idLang:"payment.transactionType"},{key:"paymentType",label:"Payment type",type:"paymentType",isRow:!0,idLang:"payment.paymentType"},{key:"totalAmount",label:"Payment total",type:"currency",isRow:!0,idLang:"payment.paymentTotal"},{key:"referenceNumber",label:"Reference",type:"",isRow:!0,idLang:"payment.reference"}];return e.jsxs(p,{children:[b.map(m=>e.jsx(kt,{isRow:!!m.isRow,type:m.type,value:r[m.key],code:(r==null?void 0:r.totalCode)||"SGD",label:x(m.idLang)})),e.jsxs(p,{sx:{display:"flex",flexDirection:"column",mb:"30px"},children:[e.jsx(de,{title:x("payment.paymentComment")}),e.jsx(w,{sx:{maxHeight:"50px"},children:a})]}),e.jsxs(p,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(de,{title:x("payment.invoicesPaid"),withColon:!1}),e.jsxs(w,{variant:"body1",children:[x("payment.paymentTowardsInvoices")," "]})]}),e.jsxs(p,{children:[e.jsxs(p,{sx:{borderBottom:"1px solid #D9DCE9",padding:"20px 15px",display:"flex",justifyContent:"space-between",fontWeight:400},children:[e.jsx(w,{sx:{fontSize:"14px",fontWeight:"500",color:"#000000"},children:x("payment.invoiceNumber")}),e.jsx(w,{sx:{fontSize:"14px",fontWeight:"500",color:"#000000"},children:x("payment.amountPaid")})]}),n.map(m=>{const{invoiceNumber:D,amount:{value:v,code:S}}=m.node,h=+(v||0),A=pe(S,h);return e.jsxs(p,{sx:{borderBottom:"1px solid #D9DCE9",padding:"20px 15px",display:"flex",justifyContent:"space-between"},children:[e.jsx(w,{children:D}),e.jsx(w,{children:A})]})})]})]})}function Bt({receiptId:r,type:n}){const[o]=oe(),[a,x]=u.useState(!1),[b,y]=u.useState(!1),[m,D]=u.useState(null),v=ie(),S=W();u.useEffect(()=>{const k=async()=>{x(!0);const{receipt:T}=await ct(+r);D(T),y(!0),x(!1)};n===U.CHECKOUT&&r&&k()},[r,n]);const h=()=>{y(!1),v("/invoice")},A=()=>e.jsx(ue,{onClick:h,variant:"text",children:S("payment.okButton")});return e.jsx(Ae,{isOpen:b,leftSizeBtn:"",customActions:A,title:S("payment.paymentSuccess"),showLeftBtn:!1,children:e.jsx(p,{sx:{width:o?"100%":"384px",maxHeight:"600px"},children:e.jsx(se,{isSpinning:a,children:e.jsx(p,{sx:{display:"flex",flexDirection:"column",flex:1},children:m?e.jsx(At,{list:m}):e.jsx(Be,{})})})})})}const Pt=300;function Dt({row:r}){var D,v;const n=u.useRef(null),o=u.useRef(null),[a,x]=u.useState(!1),[b,y]=u.useState(Pt),m=(S,{size:h})=>{y(h.height)};return u.useEffect(()=>((async()=>{x(!0);const{id:h}=r,A=await xe(h);if(!A){Z.error("pdf url resolution error");return}n!=null&&n.current&&(yt.embed(A,n.current),x(!1))})(),()=>{n.current=null}),[r]),e.jsx(se,{isSpinning:a,children:e.jsx(p,{ref:o,sx:{display:"flex",flexWrap:"wrap",width:"100%","& .box":{display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",width:"100%","& .react-resizable":{position:"relative"},"& .react-resizable-handle":{position:"absolute",width:"100%",height:"30px",backgroundRepeat:"no-repeat",backgroundOrigin:"content-box",boxSizing:"border-box"},"& .react-resizable-handle-s":{cursor:"ns-resize",bottom:0}}},children:e.jsx(ht,{className:"box",height:b,minConstraints:[((D=o==null?void 0:o.current)==null?void 0:D.offsetWidth)||0,0],width:((v=o.current)==null?void 0:v.offsetWidth)||0,onResize:m,resizeHandles:["s"],children:e.jsx("div",{style:{width:"100%",height:"".concat(b,"px")},children:e.jsx("div",{ref:n,style:{height:"100%",width:"100%"}})})})})})}const Ft=gt(p)(()=>({"& > span":{padding:"0 9px 0 0"}}));function Tt(r){const n=new Date().getTime(),{item:o,checkBox:a,handleSetSelectedInvoiceAccount:x,handleViewInvoice:b,setIsRequestLoading:y,setInvoiceId:m,handleOpenHistoryModal:D,selectedPay:v=[],handleGetCorrespondingCurrency:S,addBottom:h}=r,A=W(),k=ie(),{id:T,status:L,dueDate:E,openBalance:O}=o,R=O.code||"USD",B=S(R);let V=o.status;L===0&&n>E*1e3&&(V=3);const X=[{key:"orderNumber",title:A("invoice.invoiceItemCardHeader.order"),render:()=>e.jsx(p,{sx:{color:"#000000",cursor:"pointer",textDecoration:"underline"},onClick:()=>{k("/orderDetail/".concat(o.orderNumber))},children:(o==null?void 0:o.orderNumber)||"-"})},{key:"createdAt",title:A("invoice.invoiceItemCardHeader.invoiceDate"),render:()=>"".concat(o.createdAt?K(+o.createdAt):"–")},{key:"updatedAt",title:A("invoice.invoiceItemCardHeader.dueDate"),render:()=>{const{dueDate:d,status:P}=o,C=n>d*1e3&&P!==2;return e.jsx(w,{sx:{color:C?"#D32F2F":"rgba(0, 0, 0, 0.87)",fontSize:"14px"},children:"".concat(o.dueDate?K(+o.dueDate):"–")})}},{key:"originalBalance",title:A("invoice.invoiceItemCardHeader.invoiceTotal"),render:()=>{const{originalBalance:d}=o,P=+d.value;return ne(P||0)}},{key:"openBalance",title:A("invoice.invoiceItemCardHeader.amountDue"),render:()=>{const{openBalance:d}=o,P=+d.value;return ne(P||0)}},{key:"openBalanceToPay",title:A("invoice.invoiceItemCardHeader.amountToPay"),render:()=>{const{openBalance:d,id:P}=o;let C=d.value,$=!0;if(v.length>0){const F=v.find(N=>{const{node:{id:H}}=N;return+H==+P});if(F){const{node:{openBalance:N}}=F;$=!1,C=N.value,+d.value==0&&($=!0)}}return e.jsx(Se,{disabled:$,variant:"outlined",value:C,InputProps:{startAdornment:e.jsx(Ie,{position:"start",sx:{padding:"8px 0",marginTop:"0 !important"},children:B||"$"})},sx:{"& input":{paddingTop:"8px"}},onChange:F=>{var H;const N=(H=F.target)==null?void 0:H.value;x(N,P)},type:"number"})}}];return e.jsx(Ce,{sx:{marginBottom:v.length>0&&h?"5rem":0},children:e.jsxs(we,{sx:{color:"rgba(0, 0, 0, 0.6)"},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",mb:"0.5rem"},children:[e.jsx(Ft,{children:a&&a(!!(o!=null&&o.disableCurrentCheckbox))}),e.jsx(w,{variant:"h6",sx:{color:"rgba(0, 0, 0, 0.87)"},children:e.jsx(p,{sx:{color:"#000000",cursor:"pointer",textDecoration:"underline"},onClick:()=>{b(T,L)},children:T||"-"})})]}),e.jsx(p,{sx:{mb:"0.5rem"},children:e.jsx(Fe,{row:o,setInvoiceId:m,handleOpenHistoryModal:D,setIsRequestLoading:y})})]}),e.jsx(p,{sx:{mb:"1rem"},children:e.jsx(Te,{code:V})}),X.map(d=>e.jsxs(p,{sx:{display:"flex",alignItems:"center",mt:"4px"},children:[e.jsx(w,{sx:{fontWeight:"bold",color:"rgba(0, 0, 0, 0.87)",mr:"5px",whiteSpace:"nowrap"},children:"".concat(d.title,":")}),e.jsx(p,{sx:{color:"black",wordBreak:"break-all"},children:d!=null&&d.render?d.render():o[d.key]})]},d.key))]})})}const le={q:"",first:10,offset:0,orderBy:"-".concat(Oe[Le])};function cn(){const r=new Date().getTime(),n=W(),o=M(({company:t})=>t.customer.role),a=M(({b2bFeatures:t})=>t.masqueradeCompany.isAgenting),{invoicePayPermission:x,purchasabilityPermission:b}=M(ke),y=ie(),[m]=oe(),D=u.useRef(null),{decimal_places:v=2}=ot(),[S,h]=u.useState(!1),[A,k]=u.useState(!1),[T,L]=u.useState(""),[E,O]=u.useState(""),[R,B]=u.useState(""),[V,X]=u.useState(0),[d,P]=u.useState(0),[C,$]=u.useState([]),[F,N]=u.useState([]),[H,Re]=u.useState([]),[l,_]=u.useState(),[$e,Ne]=u.useState(n("invoice.exportCsvText")),[Ee,re]=u.useState(!1),[q,ee]=u.useState([]),{state:{bcLanguage:Ve}}=u.useContext(st),[ze,He,Ue]=pt(Oe,Le,l,_),J=mt(),ae=t=>Object.keys(t).some(s=>s!=="first"&&s!=="offset"&&s!=="orderBy"&&t[s]),Me=t=>{if(Ee){ee(t),re(!1);return}q.length||ee(t);const s=[...q];t.forEach(i=>{const c=(i==null?void 0:i.node)||i;q.some(g=>g.node.id===c.id)||s.push(i)}),ee(s)},We=async()=>{try{h(!0);const{invoiceStats:t}=await ut(l!=null&&l.status?+l.status:0);if(t){const{overDueBalance:s,totalBalance:i}=t;X(+i.toFixed(v)),P(+s.toFixed(v))}}catch(t){ce.error(t)}finally{h(!1)}},_e=(t,s)=>{t==="search"&&(_({...l,q:s}),re(!0),B(U.NORMAL))},qe=t=>{const s=t!=null&&t.startValue?be(new Date(t==null?void 0:t.startValue).getTime()/1e3):"",i=t!=null&&t.endValue?be(new Date(t==null?void 0:t.endValue).getTime()/1e3,!0):"",c=(t==null?void 0:t.status)===3?0:t==null?void 0:t.status,f={status:"".concat(c)||"",beginDateAt:s,endDateAt:i,beginDueDateAt:(t==null?void 0:t.status)===0?parseInt("".concat(r/1e3),10):"",endDueDateAt:(t==null?void 0:t.status)===3?parseInt("".concat(r/1e3),10):""};_({...l,...f}),re(!0),B(U.NORMAL)},Ge=t=>{var s;if(t.length>0){const i=((s=D.current)==null?void 0:s.getCacheList())||[],c=t.map(f=>i.find(j=>{const{node:I}=j;return+I.id==+f}));$([...c])}else $([])},fe=async(t,s)=>{try{h(!0);const c=await xe(t,b&&x&&s!==2);if(!c){Z.error(n("invoice.pdfUrlResolutionError"));return}const{href:f}=window.location;if(!f.includes("invoice"))return;window.open(c,"_blank","fullscreen=yes")}catch(i){ce.error(i)}finally{h(!1)}},Ke=(t,s)=>{const i=C.find(c=>{const{node:{id:f}}=c;return+f==+s});if(F.length>0){const c=F.map(f=>{const{node:{id:g,openBalance:j}}=f,{node:{openBalance:I}}=i;return+g==+s&&(j.value=+I.value<+t?I.value:t),f});N(c)}},Xe=async()=>{try{h(!0);const i=((l?ae(l):!1)?q.filter(I=>C.some(z=>{var he,ye;return((he=I==null?void 0:I.node)==null?void 0:he.id)===((ye=z==null?void 0:z.node)==null?void 0:ye.id)})):C).map(I=>I.node.id),c=l!=null&&l.status?[+l.status]:[];let f="-invoice_number";if(l!=null&&l.orderBy){const I=String(l.orderBy);f=I.includes("-")?"-".concat(je[I.split("-")[1]]):je[I]}const g={search:(l==null?void 0:l.q)||"",idIn:"".concat(i||""),orderNumber:"",beginDateAt:(l==null?void 0:l.beginDateAt)||null,endDateAt:(l==null?void 0:l.endDateAt)||null,status:c,orderBy:f},{invoicesExport:j}=await lt({invoiceFilterData:g,lang:Ve||"en"});j!=null&&j.url&&window.open(j==null?void 0:j.url,"_blank")}catch(t){ce.error(t)}finally{h(!1)}};u.useEffect(()=>{if(J!=null&&J.search){const t=new URLSearchParams(J.search),s=t.get("invoiceId")||"",i=t.get("receiptId")||"";s&&(_({...le,q:s}),B(U.DETAIL)),i&&(B(U.CHECKOUT),_({...le}),O(i))}else B(U.NORMAL),_({...le})},[J]),u.useEffect(()=>{const t=C.filter(s=>{const{node:{openBalance:i}}=s;return+i.value!=0})||[];if(t.length>0)if(F.length===0)N(ge(t));else{const s=t.map(i=>{const{node:{id:c,openBalance:f}}=i,g=F.find(j=>{const{node:{id:I}}=j;return+c==+I});if(g){const{node:{openBalance:j}}=g;f.value=j.value}return i});N(ge(s))}else N([])},[C]);const Je=async t=>{const{invoices:{edges:s,totalCount:i}}=await dt(t),c=s;return R===U.DETAIL&&c.length&&c.forEach(f=>{const g=f;g.node.isCollapse=!0}),c.forEach(f=>{const{node:{openBalance:g}}=f,j=f;j.node.disableCurrentCheckbox=!1,g.originValue=+g.value,g.value=(+g.value).toFixed(v)}),Re(c),We(),l&&ae(l)&&c.length?Me(c):ee([]),{edges:c,totalCount:i}},me=(t,s)=>{let i=t;if(t.includes(".")){const c=t.split("."),f=c[1].length-+v;if(c[1]&&f>0){const g=c[0]+c[1];i="".concat(g.slice(0,-v),".").concat(g.slice(-v))}}else i.length>1?i="".concat(t.slice(0,1),".").concat(t.slice(-1)):i="".concat(t);Ke(i,s)},Qe=[{key:"id",title:n("invoice.headers.invoice"),isSortable:!0,render:t=>e.jsx(p,{sx:{color:"#000000",cursor:"pointer",":hover":{textDecoration:"underline"}},onClick:()=>{fe(t.id,t.status)},children:t!=null&&t.invoiceNumber?t==null?void 0:t.invoiceNumber:t==null?void 0:t.id}),width:"8%"},{key:"orderNumber",title:n("invoice.headers.order"),isSortable:!0,render:t=>e.jsx(p,{sx:{color:"#000000",cursor:"pointer",":hover":{textDecoration:"underline"}},onClick:()=>{y("/orderDetail/".concat(t.orderNumber))},children:(t==null?void 0:t.orderNumber)||"-"}),width:"8%"},{key:"createdAt",title:n("invoice.headers.invoiceDate"),isSortable:!0,render:t=>"".concat(t.createdAt?K(+t.createdAt):"–"),width:"10%"},{key:"updatedAt",title:n("invoice.headers.dueDate"),isSortable:!0,render:t=>{const{dueDate:s,status:i}=t,c=r>s*1e3&&i!==2;return e.jsx(w,{sx:{color:c?"#D32F2F":"rgba(0, 0, 0, 0.87)",fontSize:"14px"},children:"".concat(t.dueDate?K(+t.dueDate):"–")})},width:"10%"},{key:"originalBalance",title:n("invoice.headers.invoiceTotal"),isSortable:!0,render:t=>{const{originalBalance:s}=t,i=(+s.value).toFixed(v),c=Y(s.code);return"".concat(c).concat(i||0)},width:"10%"},{key:"openBalance",title:n("invoice.headers.amountDue"),isSortable:!0,render:t=>{const{openBalance:s}=t,i=(+s.value).toFixed(v),c=Y(s.code);return"".concat(c).concat(i||0)},width:"10%"},{key:"openBalanceToPay",title:n("invoice.headers.amountToPay"),render:t=>{const{openBalance:s,id:i}=t,c=s.code||"USD";let f=s.value,g=!0;if(F.length>0){const j=F.find(I=>{const{node:{id:z}}=I;return+z==+i});if(j){const{node:{openBalance:I}}=j;g=!1,f=I.value,+s.value==0&&(g=!0)}}return e.jsx(Se,{disabled:g,variant:"outlined",value:f||"",InputProps:{startAdornment:e.jsx(Ie,{position:"start",sx:{padding:"8px 0",marginTop:"0 !important"},children:Y(c)})},sx:{"& input":{paddingTop:"8px"},'& input[type="number"]::-webkit-inner-spin-button, & input[type="number"]::-webkit-outer-spin-button':{WebkitAppearance:"none",margin:0}},onChange:j=>{var z;const I=(z=j.target)==null?void 0:z.value;me(I,i)},type:"number"})},width:"15%"},{key:"status",title:n("invoice.headers.status"),isSortable:!0,render:t=>{const{status:s,dueDate:i}=t;let c=t.status;return s===0&&r>i*1e3&&(c=3),e.jsx(Te,{code:c})}},{key:"companyName",title:n("invoice.headers.action"),render:t=>{const{id:s}=t;let i=t;if(F.length>0){const c=F.find(f=>{const{node:{id:g}}=f;return+g==+s});c&&(i=c.node)}return e.jsx(Fe,{row:i,setInvoiceId:L,handleOpenHistoryModal:k,setIsRequestLoading:h})},width:"10%"}];u.useEffect(()=>{let t=n("invoice.exportCsvText");const s=l?ae(l):!1,i=s?q.filter(c=>C.some(f=>{var g,j;return((g=c==null?void 0:c.node)==null?void 0:g.id)===((j=f==null?void 0:f.node)==null?void 0:j.id)})):C;s?t=i.length>0?n("invoice.exportSelectedAsCsv"):n("invoice.exportFilteredAsCsv"):t=i.length>0?n("invoice.exportSelectedAsCsv"):n("invoice.exportCsvText"),Ne(t)},[C,l,q]);const Ye=It.map(t=>{const s=t;return t.name==="status"&&(s.label=n(ve.status)),s.options=t.options.map(i=>{const c=i;return c.label=n(ve[i.key]),i}),t});return e.jsxs(se,{isSpinning:S,children:[e.jsxs(p,{sx:{display:"flex",flexDirection:"column",flex:1,position:"relative"},children:[e.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:m?"flex-start":"center",flexDirection:m?"column":"row"},children:[e.jsx(xt,{fiterMoreInfo:Ye,handleChange:_e,handleFilterChange:qe,startPicker:{isEnabled:!0,label:n("invoice.filter.from"),defaultValue:typeof(l==null?void 0:l.beginDateAt)=="number"?+l.beginDateAt*1e3:"",pickerKey:"start"},endPicker:{isEnabled:!0,label:n("invoice.filter.to"),defaultValue:typeof(l==null?void 0:l.endDateAt)=="number"?+l.endDateAt*1e3:"",pickerKey:"end"},searchValue:(l==null?void 0:l.q)||""}),e.jsxs(p,{sx:{display:"flex",marginBottom:"30px",flexDirection:document.body.clientWidth<=465?"column":"row"},children:[e.jsx(w,{sx:{fontSize:"24px",color:"#000000"},children:n("invoice.openUnpaid",{unpaid:ne(V)})}),document.body.clientWidth>=465&&e.jsx(w,{sx:{fontSize:"24px",margin:"0 8px"},children:"|"}),e.jsx(w,{sx:{fontSize:"24px",color:"#D32F2F"},children:n("invoice.overdueAmount",{overdue:ne(d)})})]})]}),e.jsx(it,{ref:D,columnItems:Qe,rowsPerPageOptions:[10,20,30],getRequestList:Je,searchParams:l,isCustomRender:!1,requestLoading:h,tableKey:"id",showCheckbox:x&&b,showSelectAllCheckbox:!m&&x&&b,disableCheckbox:!1,applyAllDisableCheckbox:!1,getSelectCheckbox:Ge,CollapseComponent:Dt,sortDirection:He,orderBy:Ue,sortByFn:ze,isSelectOtherPageCheckbox:!0,hover:!0,renderItem:(t,s,i)=>e.jsx(Tt,{item:t,checkBox:i,handleSetSelectedInvoiceAccount:me,handleViewInvoice:fe,setIsRequestLoading:h,setInvoiceId:L,handleOpenHistoryModal:k,selectedPay:F,handleGetCorrespondingCurrency:Y,addBottom:H.length-1===s})}),H.length>0&&!m&&e.jsx(p,{sx:{position:"absolute",bottom:"8px",left:"20px"},children:e.jsx(ue,{variant:"text",onClick:Xe,children:$e})})]}),F.length>0&&(o===0||a)&&e.jsx(jt,{selectedPay:F,decimalPlaces:v}),e.jsx(wt,{open:A,currentInvoiceId:T,setOpen:k}),e.jsx(Bt,{receiptId:+E,type:R})]})}export{cn as default};
