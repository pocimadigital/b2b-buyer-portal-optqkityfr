import{j as e,B as i,y as ye,a0 as U,I as be,T as we}from"./mui-CyG7s_nf.js";import{r as m}from"./reactVendor-BAhb8EbJ.js";import{u as Fe,d as Te}from"./router-BbCjXwHs.js";import{u as _}from"./lang-DxTEvHWx.js";import{B as Ce}from"./B3Card-B6Mzsyja.js";import{a as H,a3 as G,i as V,u as L,ar as Ie,G as Le,C as je,as as Be,a2 as Se,n as Ae,o as Pe,a5 as O,at as Re,au as ke,av as ve,aw as He,a8 as De,a6 as Me,w as Ee,ag as qe,ax as We,ay as Ue,x as Oe,az as z,aa as J,aA as ze,aB as Je}from"./react-setup-BXoEAsM4.js";import{b as Ne}from"./b3Logger-CMQiGC3f.js";import"../index.CIyF7Vyw.js";import{l as _e}from"./b3Login-Cw5_azxw.js";import{b as N,a as Ge}from"./login-tsoP8leX.js";import{a as Ve,l as Qe}from"./config-DwKgqsRk.js";import{u as Ye}from"./form-Bvi8lP6x.js";import{B as $e}from"./B3CustomForm-OSVXs3i_.js";import{a as Ke,L as Xe}from"./styled-HeAq0rir.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./eStyled-B3rIBjaz.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./lodashEs-Ck10JMnh.js";import"./muiIcon-BfPleEzf.js";import"./dateFns-BB2kaHor.js";import"./dropzone-D4lSiSJA.js";import"./validatorRules-BChXfGJH.js";function v(l){const{html:c,sx:g}=l;return e.jsx(i,{sx:{...g},dangerouslySetInnerHTML:{__html:c}})}function Ze(l){const{loginBtn:c,handleLoginSubmit:g,gotoForgotPassword:f}=l,[x]=H(),a=_(),{control:d,handleSubmit:j,getValues:h,formState:{errors:t},setValue:P}=Ye({mode:"onSubmit"}),B=F=>{g(F)},w=Ve(a,j(B));return e.jsx(i,{sx:{display:"flex",flexDirection:"column"},children:e.jsx(i,{sx:{width:"100%","& input":{bgcolor:"#F5F5F5",borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"}},children:e.jsxs("form",{onSubmit:j(B),children:[e.jsx($e,{formFields:w,errors:t,control:d,getValues:h,setValue:P,customClass:"loginForm"}),e.jsxs(i,{sx:{display:"flex",justifyContent:"flex-start ",alignItems:"center",marginTop:"1.5rem",marginBottom:"1.5rem",flexDirection:x?"column":"row",gap:"1rem"},children:[e.jsx(G,{type:"submit",variant:"contained",sx:{borderRadius:"3.125rem",background:"transparent !important",border:"1px solid #FFF !important",color:"#FFFFFF",textAlign:"center",fontFamily:"Montserrat",fontSize:"1rem",fontStyle:"normal",fontWeight:400,lineHeight:"normal",textTransform:"capitalize",letterSpacing:"0.02rem",padding:"0.7rem 1.75rem",boxShadow:"unset",":hover":{background:"#FFF !important",color:"#1B5F90",boxShadow:"unset"}},children:c}),e.jsx(i,{sx:{cursor:"pointer",textUnderlineOffset:"4px",color:"#FFF",textAlign:"center",fontFamily:"Montserrat",fontSize:"0.9375rem",fontStyle:"normal",fontWeight:400,lineHeight:"normal"},onClick:()=>f(),children:a("login.loginText.forgotPasswordText")})]})]})})})}function et(l){const{handleSubmit:c,widgetBodyText:g,createAccountButtonText:f}=l,x=ye(),[a]=H();return e.jsxs(i,{sx:{padding:a?"16px":"20px",borderRadius:"4px",mt:a?"0":"0px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(i,{component:"img",src:"https://cdn11.bigcommerce.com/s-optqkityfr/images/stencil/original/image-manager/logo-dermalink-sitio-2.png?t=1729085670",alt:"Dermalink Logo",sx:{width:"3.6rem",marginBottom:"1rem"}}),e.jsx(v,{sx:{minHeight:"250px","& .panel":{".panel-title":{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",fontWeight:400,fontSize:a?"1.375rem":"1.5rem",marginTop:"0px",color:"#EA617C"}},"& .panel-body":{".new-customer-fact-list":{lineHeight:"1.8rem"}}},html:g}),e.jsx(i,{sx:{marginTop:"5px"},children:e.jsx(G,{type:"submit",onClick:c,variant:"contained",sx:{ml:a?0:1,backgroundColor:x.palette.primary.main},children:f})})]})}const tt=()=>{const l=L(({b2bFeatures:d})=>d.masqueradeCompany.isAgenting),c=L(({company:d})=>d.customer.b2bId),g=L(({b2bFeatures:d})=>d.masqueradeCompany.id),f=V(),x=l&&typeof c=="number";return{endMasquerade:m.useCallback(async()=>{x&&(await Ae(+g,c),f(Pe()))},[c,x,g,f]),isMasquerade:x}},ot=l=>{if(l)switch(l){case"1":return"error";case"4":return"error";case"5":return"warning";default:return"success"}};function St(l){const{isMasquerade:c,endMasquerade:g}=tt(),{setOpenPage:f}=l,x=V(),a=L(Ie),d=L(({quoteInfo:n})=>n.quoteDetailToCheckoutUrl),[j,h]=m.useState(!0),[t]=H(),[P,B]=m.useState(!0),[w,F]=m.useState(""),[T,Q]=m.useState({emailAddress:"",password:""}),b=Fe(),r=_(),[R,Y]=Te(),{state:{isCheckout:$,logo:K,registerEnabled:C}}=m.useContext(Le),{state:{loginPageButton:X,loginPageDisplay:Z,loginPageHtml:ee,portalStyle:{backgroundColor:te="FEF9F5"}}}=m.useContext(je),{createAccountButtonText:oe,primaryButtonColor:ne,signInButtonText:re}=X,{displayStoreLogo:ie,pageTitle:se}=Z,{bottomHtmlRegionEnabled:ae,bottomHtmlRegionHtml:le,createAccountPanelHtml:ce,topHtmlRegionEnabled:ge,topHtmlRegionHtml:de}=ee,u={loginTitle:se||r("login.button.signIn"),loginBtn:re||r("login.button.signInUppercase"),createAccountButtonText:oe||r("login.button.createAccount"),btnColor:ne||"",widgetHeadText:ge?de:void 0,widgetBodyText:ce||Be,widgetFooterText:ae?le:void 0,logo:ie?K:void 0};m.useEffect(()=>{(async()=>{var s;try{const y=R.get("loginFlag"),k=R.get("showTip")!=="false";if(B(k),y&&F(y),y==="7"&&O.error(r("login.loginText.invoiceErrorTip")),y==="3"&&a){const A=await Re();if((s=A.data.site.cart)!=null&&s.entityId){const E=ke(A.data.site.cart.entityId);await ve(E)}const p=await N();p.errors&&console.log("LOGOUT INVALIDO: ".concat(p.errors[0].message));const{result:o}=(await N()).data.logout;if(o!=="success")return;c&&await g(),window.sessionStorage.clear(),He(),h(!1),window.location.reload();return}h(!1)}finally{h(!1)}})()},[r,g,a,c,R]);const D=(n,s="")=>{if(!n)return"";switch(n){case"1":return r("login.loginTipInfo.resetPassword",{email:s});case"2":return r("login.loginTipInfo.receivePassword");case"3":return r("login.loginTipInfo.loggedOutLogin");case"4":return r("login.loginTipInfo.accountincorrect");case"5":return r("login.loginTipInfo.accountPrelaunch");case"6":return r("login.loginText.deviceCrowdingLogIn");default:return""}},M=async n=>{const s=await Je(n);F(s?"1":"4")},me=async n=>{if(h(!0),Q(n),Y(s=>(s.delete("loginFlag"),s)),$)try{await Qe(n),window.location.reload()}catch(s){Ne.error(s),M(n.emailAddress)}else try{const s={email:n.emailAddress,password:n.password,storeHash:De,channelId:Me},{login:{result:{token:y,storefrontLoginToken:k,permissions:A},errors:p}}=await Ge({loginData:s});if(x(Ee(y)),qe.dispatch(We(A)),Ue(k),p!=null&&p[0]||!y){if(p!=null&&p[0]){const{message:o}=p[0];if(o==="Operation cannot be performed as the storefront channel is not live"){F("5"),h(!1);return}}M(n.emailAddress)}else{const o=await Oe(y);if(d){b(d);return}if((o==null?void 0:o.userType)===z.MULTIPLE_B2C&&(o==null?void 0:o.role)===J.SUPER_ADMIN){b("/dashboard");return}if(!_e(b))return;const{getShoppingListPermission:q,getOrderPermission:W}=ze();if((o==null?void 0:o.role)===J.JUNIOR_BUYER&&(o==null?void 0:o.companyRoleName)==="Junior Buyer")b(q?"/shoppingLists":"/accountSettings");else{let I=W?"/orders":"/shoppingLists";I=q||W?I:"/accountSettings",I=(o==null?void 0:o.userType)===z.B2C?"/orders":I,b(I)}}}catch(s){O.error(r("login.loginTipInfo.accountincorrect"))}finally{h(!1)}},ue=()=>{b("/register")},pe=()=>{b("/forgotpassword")},xe=C?"100%":"50%",fe=C?"calc(50% - 1.75rem)":"auto",he=m.useRef(null),S=m.useRef(null);return m.useEffect(()=>(S.current=setInterval(()=>{const n=document.getElementById("loginBox");n&&(n.click(),clearInterval(S.current))},500),()=>{S.current&&clearInterval(S.current)}),[]),e.jsx(Ce,{setOpenPage:f,children:e.jsx(Ke,{paddings:t?"0":"20px 20px",children:e.jsx(Se,{isSpinning:j,tip:r("global.tips.loading"),background:"transparent",children:e.jsx(i,{sx:{display:"flex",flexDirection:"column",width:"100%",minHeight:"400px",minWidth:"343px"},children:u&&e.jsxs(e.Fragment,{children:[d&&e.jsx(U,{severity:"error",variant:"outlined",children:r("login.loginText.quoteDetailToCheckoutUrl")}),u.logo&&e.jsx(i,{sx:{margin:"20px 0",minHeight:"150px"},children:e.jsx(Xe,{children:e.jsx(be,{sx:{maxWidth:t?"70%":"250px"},onClick:()=>{window.location.href="/"},children:e.jsx("img",{src:u.logo,alt:r("login.registerLogo"),loading:"lazy"})})})}),w&&P&&e.jsx(i,{sx:{padding:t?0:"0 5%",margin:"10px 0 0 0"},children:D(w,T==null?void 0:T.emailAddress)&&e.jsx(U,{severity:ot(w),variant:"outlined",children:D(w,(T==null?void 0:T.emailAddress)||"")})}),u.widgetHeadText&&e.jsx(v,{sx:{minHeight:"48px",width:C||t?"100%":"50%"},html:u.widgetHeadText}),e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:e.jsx(i,{sx:{bgcolor:"#FFFFFF",borderRadius:"4px",margin:"20px 0",display:"flex",flexDirection:"column",justifyContent:"center",width:t?"100%":xe},children:e.jsxs(i,{sx:{mb:"20px",display:"flex",flexDirection:t?"column":"row",justifyContent:"center",alignItems:"center",padding:"0 15px",width:t?"auto":"100%",gap:t?"1.25rem":"1.75rem"},children:[e.jsxs(i,{id:"loginBox",ref:he,tabIndex:-1,sx:{width:t?"100%":fe,maxWidth:t?"unset":"35rem",pb:C?"":"36px",background:"linear-gradient(92deg, #1B5F90 16.56%, #0976C4 77.16%)",borderRadius:"0.625rem",display:"flex",justifyContent:"center",alignItems:"center",minHeight:t?"16rem":"100%",flexDirection:"column",padding:t?"1.25rem":"2.5rem"},children:[e.jsx(we,{variant:"h2",sx:{width:"100%",margin:"2rem 0",display:"flex",justifyContent:"left",alignItems:"center",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:t?"1.625rem":"2.5rem",textAlign:t?"center":"initial",mt:t?"1rem":"0",color:"#FFF"},children:r("login.loginText.signInHeader")}),e.jsx(Ze,{loginBtn:u.loginBtn,gotoForgotPassword:pe,handleLoginSubmit:me,backgroundColor:te})]}),C&&e.jsx(i,{sx:{flex:"1",background:"#FFF",boxShadow:"2px 2px 10px 0px rgba(0, 0, 0, 0.25)",borderRadius:"0.625rem",display:"flex",justifyContent:"center",alignItems:"center",minHeight:t?"16rem":"28rem",padding:t?"1.25rem":"2.5rem",maxWidth:t?"unset":"35rem"},children:e.jsx(et,{createAccountButtonText:u.createAccountButtonText,widgetBodyText:u.widgetBodyText,handleSubmit:ue})})]})})}),u.widgetFooterText&&e.jsx(v,{sx:{minHeight:"48px",width:C||t?"100%":"50%"},html:u.widgetFooterText})]})})})})})}export{St as default};
