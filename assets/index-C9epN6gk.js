import{j as e,B as T,a0 as je,T as Pe,v as Ke,ai as We,w as ve,aj as ke,y as Ge,ak as qe,al as De,am as $e,I as Je}from"./mui-CyG7s_nf.js";import{r as c}from"./reactVendor-BAhb8EbJ.js";import{u as Ce}from"./lang-DxTEvHWx.js";import{B as Qe}from"./B3Card-BPAvmYdc.js";import{bq as Ie,G as Ve,C as Se,k as ye,a6 as he,a8 as Ee,br as Xe,bm as Ye,u as Oe,bs as Ue,a as Be,W as pe,N as ze,bt as Ze,a2 as et,a4 as tt,ac as ot,x as at}from"./react-setup-CrWNYFBB.js";import{b as ue}from"./b3Logger-CMQiGC3f.js";import"../index.4Vx3iznQ.js";import{l as nt}from"./b3Login-BA1bWUrI.js";import{c as st}from"./login-BF-lykfT.js";import{l as rt}from"./config-CQp0mkSw.js";import{d as ge,t as it,B as we,e as ct,s as lt,b as dt,g as Ne,c as ut}from"./config-DZJgeGtH.js";import{n as mt}from"./eStyled-B3rIBjaz.js";import{u as Ae}from"./form-Bvi8lP6x.js";import{B as Fe}from"./B3CustomForm-DfghNiXt.js";import{T as Me,R as Te,c as ft,s as pt,I as Le,v as gt,a as ht,b as yt,d as xt,e as bt}from"./RegisteredFinish-CLdCfmpf.js";import{C as Ft,g as Ct}from"./recaptcha-Cyg1uIXK.js";import{a as It,c as wt}from"./users-BGYNS6Dg.js";import{i as St}from"./lodashEs-Ck10JMnh.js";import{u as Bt}from"./router-BbCjXwHs.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./muiIcon-BfPleEzf.js";import"./dateFns-BB2kaHor.js";import"./dropzone-D4lSiSJA.js";import"./validatorRules-DrYR9fme.js";function _t(Y){const B=Ce(),{handleBack:R,activeStep:U,handleNext:W}=Y,[_,C]=c.useState([]),[N,P]=c.useState(""),[y,j]=c.useState(""),[q,Z]=c.useState(""),[z,V]=c.useState(!1),[A,oe]=c.useState(""),[ee,ae]=c.useState(!1),I=p=>Z(p);c.useEffect(()=>{(async()=>{try{const n=await Ct();n&&(V(n.isEnabledOnStorefront),oe(n.siteKey))}catch(n){ue.error(n)}})()},[]),c.useEffect(()=>{q&&ae(!1)},[q]);const{control:me,handleSubmit:re,setError:ne,formState:{errors:ie}}=Ae({mode:"all"}),{state:ce,dispatch:te}=c.useContext(Ie),{state:{blockPendingAccountOrderCreation:H}}=c.useContext(Ve),{state:{portalStyle:{backgroundColor:D="#FEF9F5"}}}=c.useContext(Se),h=ye(D),{contactInformation:O,bcContactInformation:w,passwordInformation:m=[],bcPasswordInformation:v=[],accountType:S,additionalInformation:le,bcAdditionalInformation:$,addressBasicFields:J=[],bcAddressBasicFields:k=[],companyInformation:f=[],emailMarketingNewsletter:M}=ce,x=S==="1"?O:w,G=S==="1"?m:v,L=S==="1"?le:$,g=S==="1"?J:k;c.useEffect(()=>{if(S){if(x&&x.length){const p=x.find(n=>n.name==="email")||{};j((p==null?void 0:p.default)||"")}C(G)}},[O,w,S,x,G]);const r=p=>{const n={};if(n.authentication={force_password_reset:!1,new_password:p.password},n.accepts_product_review_abandoned_cart_emails=M,x&&(x.forEach(t=>{var i;const d=ge(t.name);d==="accepts_marketing_emails"?n.accepts_product_review_abandoned_cart_emails=!!((i=t==null?void 0:t.default)!=null&&i.length):t.custom||(n[d]=(t==null?void 0:t.default)||"")}),n.form_fields=[],L&&L.length&&L.forEach(t=>{n.form_fields.push({name:t.bcLabel,value:t.default})})),n.addresses=[],n.origin_channel_id=he,n.channel_ids=[he],S==="2"){const t={},d=g.filter(l=>!l.custom),i=g.filter(l=>l.custom);d&&(n.addresses={},d.forEach(l=>{l.name==="country"?t.country_code=l.default:l.name==="state"?t.state_or_province=l.default:l.name==="postalCode"?t.postal_code=l.default:l.name==="firstName"?t.first_name=l.default:l.name==="lastName"?t.last_name=l.default:t[l.name]=l.default})),t.form_fields=[],i&&i.length&&i.forEach(l=>{t.form_fields.push({name:l.bcLabel,value:l.default})}),n.addresses=[t],n.trigger_account_created_notification=!0}const E={storeHash:Ee,...n};return ft(E)},u=async(p,n,E)=>{try{const t={};t.customerId=n||"",t.storeHash=Ee;const i=(x||[]).filter(o=>!!o.custom);if(i.length){const o=[];i.forEach(s=>{const b={};b.fieldName=ge(s.name),b.fieldValue=(s==null?void 0:s.default)||"",o.push(b)}),t.userExtraFields=o}const l=f.filter(o=>!o.custom&&o.fieldType!=="files"),X=f.filter(o=>!!o.custom);if(l.length&&l.forEach(o=>{t[it(ge(o.name))]=(o==null?void 0:o.default)||""}),X.length){const o=[];X.forEach(s=>{const b={};b.fieldName=ge(s.name),b.fieldValue=(s==null?void 0:s.default)||"",o.push(b)}),t.extraFields=o}const a=g.filter(o=>!o.custom)||[],F=g.filter(o=>!!o.custom)||[];if(a.length&&a.forEach(o=>{const s=ge(o.name);s==="address1"&&(t.addressLine1=o.default),s==="address2"&&(t.addressLine2=o.default),t[s]=o.default}),F.length){const o=[];F.forEach(s=>{const b={};b.fieldName=ge(s.name),b.fieldValue=(s==null?void 0:s.default)||"",o.push(b)}),t.addressExtraFields=o}return t.fileList=E,t.channelId=he,await Xe(t)}catch(t){ue.error(t)}},Q=async p=>{let n=[];if(p.length){p.forEach(E=>{n=E.default});try{return(await Promise.all(n.map(d=>Ye({file:d,type:"companyAttachedFile"})))).reduce((d,i)=>{let l=d;if(i.code===200){const X={...i.data};X.fileSize=X.fileSize?"".concat(X.fileSize):"",l=[...d,X]}else throw i.data.errMsg||i.message||B("intl.global.fileUpload.fileUploadFailure");return l},[])}catch(E){throw ue.error(E),E}}},se=p=>{const n=m.map(t=>{const d=t;return S==="1"&&(d.default=p[t.name]||t.default),t}),E=v.map(t=>{const d=t;return S==="2"&&(d.default=p[t.name]||t.default),t});te({type:"all",payload:{passwordInformation:n,bcPasswordInformation:E}})},fe=async()=>{if(x&&x.length>0){const p=x.find(i=>i.fieldId==="field_email_marketing_newsletter"&&i.fieldType==="checkbox"),n=x.find(i=>i.fieldId==="field_first_name")||{},E=x.find(i=>i.fieldId==="field_last_name")||{},t=(p==null?void 0:p.isChecked)||!1,d=(p==null?void 0:p.default)||[];if(t&&d.length>0)try{await pt({storeHash:Ee,email:y,first_name:n.default,last_name:E.default,channel_id:he||1})}catch(i){P((i==null?void 0:i.message)||i)}}},xe=p=>{re(async n=>{var E,t;if(n.password!==n.confirmPassword){ne("confirmPassword",{type:"manual",message:B("global.registerComplete.passwordMatchPrompt")}),ne("password",{type:"manual",message:B("global.registerComplete.passwordMatchPrompt")});return}if(z&&!q){ae(!0);return}if(!ee)try{te({type:"loading",payload:{isLoading:!0}});let d=!0;if(S==="2")await r(n);else{const i=f.filter(s=>s.fieldType==="files"),l=await Q(i||[]),X=await r(n),{data:a}=X,F=await u(n,a.id,l);d=+(((t=(E=F==null?void 0:F.companyCreate)==null?void 0:E.company)==null?void 0:t.companyStatus)||"")==1}te({type:"finishInfo",payload:{submitSuccess:!0,isAutoApproval:d,blockPendingAccountOrderCreation:H}}),se(n),await fe(),W()}catch(d){P((d==null?void 0:d.message)||d)}finally{te({type:"loading",payload:{isLoading:!1}})}})(p)};return e.jsxs(T,{sx:{pl:1,pr:1,mt:2,width:"100%","& h4":{color:h},"& input, & .MuiFormControl-root .MuiTextField-root":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",padding:"10px !important"}},children:[N&&e.jsx(je,{severity:"error",children:e.jsx(Me,{children:N})}),e.jsxs(T,{children:[_&&e.jsxs(e.Fragment,{children:[y.length>0&&e.jsx(T,{sx:{fontSize:"16px",fontWeight:400,color:"#000000",marginBottom:"10px",marginTop:"-12px",wordWrap:"break-word",textAlign:"center"},children:"Ahora por favor crea una contraseña para tu cuenta: ".concat(y)}),e.jsx(Fe,{formFields:_,errors:ie,control:me})]}),ee?e.jsx(Pe,{variant:"body1",sx:{display:"flex",alignSelf:"flex-start",marginLeft:"8px",marginTop:"2px",fontSize:"13px"},children:B("login.loginText.missingCaptcha")}):"",z?e.jsx(T,{sx:{display:"flex",justifyContent:"center",marginTop:"20px"},children:e.jsx(Ft,{siteKey:A,size:"normal",handleGetKey:I})}):""]}),e.jsx(Te,{handleBack:R,activeStep:U,handleNext:xe,email:y})]})}function Et(Y){var J,k;const{handleBack:B,handleNext:R,activeStep:U}=Y,{state:W,dispatch:_}=c.useContext(Ie),C=Oe(Ue),{state:{accountLoginRegistration:N,portalStyle:{backgroundColor:P="#FEF9F5"}}}=c.useContext(Se),y=ye(P),j=Ce(),[q]=Be(),[Z,z]=c.useState(""),{contactInformation:V,accountType:A,additionalInformation:oe,bcContactInformation:ee,bcAdditionalInformation:ae}=W,{control:I,handleSubmit:me,getValues:re,formState:{errors:ne},setError:ie,setValue:ce}=Ae({mode:"onSubmit"}),te=A==="1"?"additionalInformation":"bcAdditionalInformation",H=A==="1"?oe||[]:ae||[],D=V==null?void 0:V.map(f=>{const M=f;return f.fieldId==="field_email"&&A==="1"&&(M.isTip=!1),f}),h=A==="1"?D:ee||[],O=A==="1"?"contactInformation":"bcContactInformationFields",w=H.length?(J=H[0])==null?void 0:J.groupName:"",m=(f=!1)=>{_({type:"loading",payload:{isLoading:f}})},v=f=>{_({type:"accountType",payload:{accountType:f.target.value}})},S=((k=V==null?void 0:V.find(f=>f.fieldId==="field_email"))==null?void 0:k.name)||"email",le=async f=>{const M=A==="1";try{m(!0);const{isValid:x,userType:G,userInfo:{companyName:L=""}={}}=M?await It({email:f,channelId:he}):await wt({email:f,channelId:he});return x?z(""):(z(j(ct[G],{companyName:L||"",email:f})),ie(S,{type:"custom",message:""}),C==null||C.body.scrollIntoView(!0)),x}catch(x){return!1}finally{m(!1)}},$=async f=>{me(async M=>{var L;if(!await le(M[S]))return;const x=h.map(g=>{const r=g;return r.default=M[g.name]||g.default,g.fieldId==="field_email_marketing_newsletter"&&g.fieldType==="checkbox"&&(r.isChecked=M[g.name].length>0),g});try{if(m(!0),A==="1"){const g=x.filter(u=>!!u.custom),r=g.map(u=>({fieldName:we.decode(u.name),fieldValue:M[u.name]||u.default}));if(r.length>0){const u=await gt({extraFields:r});if(u.code!==200){const Q=((L=u.data)==null?void 0:L.errMsg)||u.message||"",se=Q.split(":");if(se.length>=2){const fe=g.find(xe=>we.decode(xe.name)===se[0]);if(fe){ie(fe.name,{type:"manual",message:se[1]}),m(!1);return}}z(Q),m(!1);return}}z("")}}catch(g){ue.error(g)}finally{m(!1)}let G=[];H&&(G=H.map(g=>{const r=g;return r.default=M[g.name]||g.default,g})),_({type:"all",payload:{[te]:[...G],[O]:[...x]}}),R()})(f)};return e.jsxs(T,{sx:{pl:1,pr:1,mt:2,width:"100%"},children:[Z&&e.jsx(je,{severity:"error",children:e.jsx(Me,{children:Z})}),e.jsx(T,{component:"div",sx:{color:"#000000",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:q?"0.875rem":"1rem",textAlign:q?"center":"center ",padding:"0px 15px"},dangerouslySetInnerHTML:{__html:j("register.step.account.customText")}}),e.jsx(Ke,{sx:{"& h4":{color:y}},children:e.jsxs(We,{"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",value:A,onChange:v,sx:{display:"none","& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label":{color:pe(y,.87)},"& .MuiButtonBase-root.MuiRadio-root.MuiRadio-colorPrimary:not(.Mui-checked)":{color:pe(y,.6)}},children:[N.b2b&&e.jsx(ve,{value:"1",control:e.jsx(ke,{}),label:j("register.registeredAccount.businessAccount")}),N.b2c&&e.jsx(ve,{value:"2",control:e.jsx(ke,{}),label:j("register.registeredAccount.personalAccount")})]})}),e.jsx(T,{sx:{"& h4":{color:y},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",padding:"10px !important"},"& .MuiButtonBase-root.MuiCheckbox-root.MuiCheckbox-colorPrimary:not(.Mui-checked)":{color:pe(y,.6)},"& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label":{color:pe(y,.87)}},children:e.jsx(Fe,{formFields:h,errors:ne,control:I,getValues:re,setValue:ce})}),e.jsx(T,{}),H&&H.length?e.jsxs(T,{sx:{"& h4":{color:y},"& .MuiFormControlLabel-label, & .MuiFormControl-root .MuiFormLabel-root:not(.Mui-focused)":{color:pe(y,.87)},"& .MuiRadio-root:not(.Mui-checked)":{color:pe(y,.6)}},children:[e.jsx(Le,{children:w}),e.jsx(Fe,{formFields:H,errors:ne,control:I,getValues:re,setValue:ce})]}):"",e.jsx(Te,{activeStep:U,handleBack:B,handleNext:$})]})}function Lt(Y){var n,E,t,d,i,l,X;const B=Ce(),[R]=Be(),{handleBack:U,handleNext:W,activeStep:_}=Y,{state:C,dispatch:N}=c.useContext(Ie),P=C.contactInformation||[],y=C.companyInformation||[],j=((n=P.find(a=>a.fieldId==="field_first_name"))==null?void 0:n.default)||"",q=((E=P.find(a=>a.fieldId==="field_last_name"))==null?void 0:E.default)||"",Z="".concat(j," ").concat(q).trim(),z=y.find(a=>a.fieldId==="field_company_name");z&&(z.default=Z);const V=((t=P.find(a=>a.fieldId==="field_email"))==null?void 0:t.default)||"",A=y.find(a=>a.fieldId==="field_company_email");A&&(A.default=V);const oe=((d=P.find(a=>a.fieldId==="field_phone_number"))==null?void 0:d.default)||"",ee=y.find(a=>a.fieldId==="field_company_phone_number");ee&&(ee.default=oe);const ae=((i=P.find(a=>a.label==="Cédula profesional"))==null?void 0:i.default)||"",I=y.find(a=>a.label==="Cédula profesional");I&&(I.default=ae);const re=new URLSearchParams(window.location.search).get("utm_source")||"",ne=P.find(a=>a.label==="utm_source");ne&&(ne.default=re);const{state:{portalStyle:{backgroundColor:ie="#FEF9F5"}}}=c.useContext(Se),ce=ye(ie),[te,H]=c.useState(""),{accountType:D="1",companyInformation:h=[],companyAttachment:O=[],addressBasicFields:w=[],bcAddressBasicFields:m=[],countryList:v=[]}=C,{control:S,handleSubmit:le,getValues:$,formState:{errors:J},setValue:k,watch:f,setError:M}=Ae({mode:"all"}),x=D==="1"?(l=h[0])==null?void 0:l.groupName:"",G=D==="1"?"addressBasicFields":"bcAddressBasicFields",L=D==="1"?w:m,g=((X=L[0])==null?void 0:X.groupName)||"",r=c.useCallback((a,F="")=>{var b;const o=((b=v.find(K=>K.countryCode===a||K.countryName===a))==null?void 0:b.states)||[],s=L.find(K=>K.name==="state");s&&(o.length>0?(s.fieldType="dropdown",s.options=o):(s.fieldType="text",s.options=[])),k("state",F&&a&&(o.find(K=>K.stateName===F)||o.length===0)?F:""),N({type:"stateList",payload:{stateList:o,addressBasicFields:w,bcAddressBasicFields:m,[G]:[...L]}})},[w,L,G,m,v]);c.useEffect(()=>{const a=$("country"),F=$("state");r(a,F)},[]),c.useEffect(()=>{const a=f((F,{name:o,type:s})=>{const{country:b,state:K}=F;o==="country"&&s==="change"&&r(b,K)});return()=>a.unsubscribe()},[v,r]);const u=(a=!1)=>{N({type:"loading",payload:{isLoading:a}})},Q=(a,F)=>a.map(o=>{const s=o;return s.default=F[o.name]||o.default,o}),se=()=>{const a=[...h,...O,...L].reduce((b,K)=>{const be=b;return be[K.name]=$(K.name)||K.default,b},{}),F=Q(h,a),o=Q(O,a),s=Q(L,a);N({type:"all",payload:{companyInformation:[...F],companyAttachment:[...o],[G]:[...s]}})},fe=()=>{var a;if(D==="1"){const F=$(),o=h.find(s=>s.fieldId==="field_attachments");if(!St(o)&&o.required&&F[o.name].length===0)return M(o.name,{type:"required",message:B("global.validate.required",{label:(a=o.label)!=null?a:""})}),u(!1),!0}return!1},xe=a=>{const F=fe();le(async o=>{var s;if(!F){u(!0);try{if(D==="1"){const b=h.filter(de=>!!de.custom),K=b.map(de=>({fieldName:we.decode(de.name),fieldValue:o[de.name]||de.default})),be=await ht({extraFields:K});if(be.code!==200){const de=((s=be.data)==null?void 0:s.errMsg)||be.message||"",_e=de.split(":");if(_e.length>=2){const Re=b.find(He=>we.decode(He.name)===_e[0]);if(Re){M(Re.name,{type:"manual",message:_e[1]}),u(!1);return}}H(de),u(!1);return}H("")}se(),u(!1),W()}catch(b){u(!1)}}})(a)},p=()=>{se(),U()};return e.jsxs(T,{sx:{pl:1,pr:1,mt:2,width:"100%","& h4":{color:ce},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiDropzoneArea-textContainer, & .MuiSelect-select.MuiSelect-outlined, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",padding:"10px !important"}},children:[te&&e.jsx(je,{severity:"error",children:e.jsx(Me,{children:te})}),e.jsx(T,{component:"div",sx:{color:"#000000",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:R?"0.875rem":"1rem",textAlign:R?"center":"center ",padding:"0px 15px"},dangerouslySetInnerHTML:{__html:B("register.step.details.customText")}}),D==="1"?e.jsxs(T,{sx:{display:"none !important"},children:[e.jsx(Le,{children:x}),e.jsx(Fe,{formFields:[...h],errors:J,control:S,getValues:$,setValue:k,setError:M})]}):null,e.jsxs(T,{children:[e.jsx(Le,{children:g}),e.jsx(Fe,{formFields:L,errors:J,control:S,getValues:$,setValue:k})]}),e.jsx(Te,{handleBack:p,handleNext:xe,activeStep:_})]})}const jt=mt(T)({"& #b3-customForm-id-name":{'& label[data-shrink="true"]':{whiteSpace:"break-spaces",transition:"unset",background:"white"},'& label[data-shrink="false"]':{whiteSpace:"break-spaces",color:"#474747",fontFamily:"Montserrat",fontSize:"0.9375rem",fontStyle:"normal",fontWeight:400,lineHeight:"normal",top:"-4px",background:"white"}}});function At(Y){const{activeStep:B,handleBack:R,handleNext:U,handleFinish:W}=Y,_=C=>{switch(C){case 0:return e.jsx(Et,{activeStep:B,handleBack:R,handleNext:U});case 1:return e.jsx(Lt,{activeStep:B,handleBack:R,handleNext:U});case 2:return e.jsx(_t,{activeStep:B,handleBack:R,handleNext:U});case 3:return e.jsx(yt,{activeStep:B,handleFinish:W});default:return null}};return e.jsx(jt,{component:"div",children:_(B)})}function Mt(Y){const{children:B,isStepOptional:R,activeStep:U,backgroundColor:W}=Y,_=Ce(),[C]=Be(),N=Ge(),{state:P}=c.useContext(Ie),{accountType:y,submitSuccess:j,isAutoApproval:q}=P,Z=ze.get("blockPendingAccountOrderCreation")&&!q,z=_(Z?"register.title.registerCompleteWarning":"register.title.registerComplete"),V=y==="1"?z:_("register.title.accountCreated"),A=ye(W);return c.useEffect(()=>{j&&(console.log("User registered"),console.log(j),window.parent.postMessage({method:"postMessageB2BRegister",data:{type:"TRACK_COMPLETE_REGISTRATION"}},"*"))},[j]),e.jsxs(T,{component:"div",sx:{borderRadius:"4px",marginTop:"3px",background:"#FFFFFF",width:"100%",padding:C?"0 20px":"0 20%"},children:[e.jsx(T,{component:"h3",sx:{color:"#474747",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:C?"1.625rem":"2.5rem",textAlign:C?"center":"center "},children:j?V:_("register.title.accountRegister")}),!j&&e.jsx(qe,{activeStep:U,sx:{display:"none","& .MuiSvgIcon-root:not(.Mui-active) .MuiStepIcon-text":{fill:ye(A)},"& .MuiSvgIcon-root.Mui-active .MuiStepIcon-text":{fill:ye(N.palette.primary.main)}},children:lt.map((oe,ee)=>{const ae={},I={};return R(ee)&&(I.optional=e.jsx(Pe,{variant:"caption",children:_("register.step.optional")})),e.jsx(De,{...ae,children:e.jsx($e,{...I,children:_(oe)})},oe)})}),B]})}const Tt=[1,2];function io(Y){const{setOpenPage:B}=Y,[R,U]=c.useState(0),W=Ce(),[_]=Be(),C=Bt(),N=Oe(Ue),{state:{isCheckout:P,isCloseGotoBCHome:y,logo:j,storeName:q,registerEnabled:Z}}=c.useContext(Ve),{state:{isLoading:z,accountType:V,contactInformation:A=[],passwordInformation:oe=[],bcPasswordInformation:ee=[],bcContactInformation:ae=[]},dispatch:I}=c.useContext(Ie),{state:{accountLoginRegistration:me,portalStyle:{backgroundColor:re="#FEF9F5"}}}=c.useContext(Se);c.useEffect(()=>{Z||C("/login")},[Z]),c.useEffect(()=>{(async()=>{var O,w,m,v;try{I&&(I({type:"loading",payload:{isLoading:!0}}),I({type:"finishInfo",payload:{submitSuccess:!1}}));const S=Tt.map(r=>tt(r)),le=await Promise.all(S),$=(((O=le[1])==null?void 0:O.accountFormFields)||[]).map(r=>{const u=r;return dt.includes((r==null?void 0:r.fieldId)||"")&&r.groupId===4&&(u.isRequired=!0,u.visible=!0),r}),J=Ne(((w=le[0])==null?void 0:w.accountFormFields)||[]),k=Ne($||[]),{countries:f}=await ot(),M=((m=k.address)==null?void 0:m.map(r=>{const u=r;return r.name==="country"&&(u.options=f,u.replaceOptions={label:"countryName",value:"countryName"}),r}))||[],x=((v=J.address)==null?void 0:v.map(r=>{const u=r;if(r.name==="country"){u.options=f;const Q=f.find(se=>se.countryName===r.default);u.default=(Q==null?void 0:Q.countryCode)||r.default}return r}))||[],{b2b:G,b2c:L}=me;I&&I({type:"all",payload:{accountType:L&&!G?"2":"1",isLoading:!1,storeName:q,contactInformation:[...k.contactInformation||[]],bcContactInformation:[...J.contactInformation||[]],additionalInformation:[...k.additionalInformation||[]],bcAdditionalInformation:[...J.additionalInformation||[]],companyExtraFields:[],companyInformation:[...(k==null?void 0:k.businessDetails)||[]],companyAttachment:[...ut(W)],addressBasicFields:[...M],bcAddressBasicFields:[...x],countryList:[...f],passwordInformation:[...k.password||[]],bcPasswordInformation:[...J.password||[]]}})}catch(S){ue.error(S)}})()},[]);const ne=h=>h===-1,ie=()=>{var w,m;const h=((w=(V==="1"?A:ae).find(v=>v.name==="email"))==null?void 0:w.default)||"",O=((m=(V==="1"?oe:ee).find(v=>v.name==="password"))==null?void 0:m.default)||"";return{emailAddress:h,password:O}},ce=async()=>{U(h=>h+1)},te=()=>{U(h=>h-1)},H=()=>{I&&I({type:"all",payload:{accountType:"",isLoading:!1,storeName:"",submitSuccess:!1,contactInformation:[],additionalInformation:[],companyExtraFields:[],companyInformation:[],companyAttachment:[],addressBasicFields:[],addressExtraFields:[],countryList:[],passwordInformation:[]}})},D=async()=>{var O;I({type:"loading",payload:{isLoading:!0}});const h=ie();if(P)try{await rt(h),window.location.reload()}catch(w){ue.error(w)}else try{const w={email:h.emailAddress,pass:h.password},{data:m}=await st(w);if((O=m==null?void 0:m.login)!=null&&O.customer&&ze.set("loginCustomer",{emailAddress:m.login.customer.email,phoneNumber:m.login.customer.phone,...m.login.customer}),await at(),H(),!nt(C))return;y?window.location.href="/":C("/orders")}catch(w){ue.error(w)}I({type:"loading",payload:{isLoading:!1}})};return c.useEffect(()=>{N==null||N.body.scrollIntoView(!0)},[R]),Ze(!1),e.jsx(Qe,{setOpenPage:B,children:e.jsx(xt,{isMobile:_,children:e.jsx(et,{isSpinning:z,tip:W("global.tips.loading"),transparency:"0",children:e.jsxs(T,{sx:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center"},children:[j&&e.jsx(bt,{children:e.jsx(Je,{sx:{maxWidth:"250px"},onClick:()=>{window.location.href="/"},children:e.jsx("img",{src:"".concat(j),alt:W("global.tips.registerLogo"),loading:"lazy"})})}),e.jsx(Mt,{activeStep:R,isStepOptional:ne,backgroundColor:re,children:e.jsx(At,{activeStep:R,handleBack:te,handleNext:ce,handleFinish:D})})]})})})})}export{io as default};
