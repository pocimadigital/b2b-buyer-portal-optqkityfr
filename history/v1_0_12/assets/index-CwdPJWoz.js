import{j as t,B as T,a0 as Ee,T as ke,v as Ue,ai as He,w as Te,aj as Re,y as Ke,ak as We,al as Ge,am as qe,I as De}from"./mui-CyG7s_nf.js";import{r as c}from"./reactVendor-BAhb8EbJ.js";import{u as be}from"./lang-DxTEvHWx.js";import{B as $e}from"./B3Card-D-1G9_aj.js";import{bq as Fe,G as Ne,C as Ie,k as ye,a6 as he,a8 as Be,br as Je,bm as Qe,u as Pe,bs as Ve,a as we,W as pe,N as Oe,bt as Xe,a2 as Ye,a4 as Ze,ac as et,x as tt}from"./react-setup-BE8w6ZrM.js";import{b as ue}from"./b3Logger-CMQiGC3f.js";import"../index.CrdzTz2H.js";import{l as ot}from"./b3Login-tk0Yqrlt.js";import{c as at}from"./login-eM4H7ltc.js";import{l as nt}from"./config-DnO7X9tG.js";import{d as ge,t as st,B as Ce,e as rt,s as it,b as ct,g as ve,c as lt}from"./config-DlTAaUMq.js";import{n as dt}from"./eStyled-B3rIBjaz.js";import{u as je}from"./form-Bvi8lP6x.js";import{B as xe}from"./B3CustomForm-BKoFYO-g.js";import{T as Ae,R as Le,c as ut,s as mt,I as _e,v as ft,a as pt,b as gt,d as ht,e as yt}from"./RegisteredFinish-SZcX0mWK.js";import{C as xt,g as bt}from"./recaptcha-C4horHsz.js";import{a as Ft,c as Ct}from"./users-DXcpu5WJ.js";import{i as It}from"./lodashEs-Ck10JMnh.js";import{u as wt}from"./router-BbCjXwHs.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./muiIcon-BfPleEzf.js";import"./dateFns-BB2kaHor.js";import"./dropzone-D4lSiSJA.js";import"./validatorRules-DM4k5g_x.js";function St(q){const S=be(),{handleBack:R,activeStep:z,handleNext:K}=q,[B,I]=c.useState([]),[V,Y]=c.useState(""),[y,j]=c.useState(""),[G,D]=c.useState(""),[W,v]=c.useState(!1),[k,$]=c.useState(""),[Z,J]=c.useState(!1),_=m=>D(m);c.useEffect(()=>{(async()=>{try{const n=await bt();n&&(v(n.isEnabledOnStorefront),$(n.siteKey))}catch(n){ue.error(n)}})()},[]),c.useEffect(()=>{G&&J(!1)},[G]);const{control:ie,handleSubmit:ce,setError:te,formState:{errors:oe}}=je({mode:"all"}),{state:ae,dispatch:O}=c.useContext(Fe),{state:{blockPendingAccountOrderCreation:A}}=c.useContext(Ne),{state:{portalStyle:{backgroundColor:le="#FEF9F5"}}}=c.useContext(Ie),C=ye(le),{contactInformation:N,bcContactInformation:w,passwordInformation:g=[],bcPasswordInformation:U=[],accountType:x,additionalInformation:ne,bcAdditionalInformation:se,addressBasicFields:Q=[],bcAddressBasicFields:P=[],companyInformation:p=[],emailMarketingNewsletter:L}=ae,d=x==="1"?N:w,X=x==="1"?g:U,H=x==="1"?ne:se,l=x==="1"?Q:P;c.useEffect(()=>{if(x){if(d&&d.length){const m=d.find(n=>n.name==="email")||{};j((m==null?void 0:m.default)||"")}I(X)}},[N,w,x,d,X]);const r=m=>{const n={};if(n.authentication={force_password_reset:!1,new_password:m.password},n.accepts_product_review_abandoned_cart_emails=L,d&&(d.forEach(o=>{var i;const u=ge(o.name);u==="accepts_marketing_emails"?n.accepts_product_review_abandoned_cart_emails=!!((i=o==null?void 0:o.default)!=null&&i.length):o.custom||(n[u]=(o==null?void 0:o.default)||"")}),n.form_fields=[],H&&H.length&&H.forEach(o=>{n.form_fields.push({name:o.bcLabel,value:o.default})})),n.addresses=[],n.origin_channel_id=he,n.channel_ids=[he],x==="2"){const o={},u=l.filter(e=>!e.custom),i=l.filter(e=>e.custom);u&&(n.addresses={},u.forEach(e=>{e.name==="country"?o.country_code=e.default:e.name==="state"?o.state_or_province=e.default:e.name==="postalCode"?o.postal_code=e.default:e.name==="firstName"?o.first_name=e.default:e.name==="lastName"?o.last_name=e.default:o[e.name]=e.default})),o.form_fields=[],i&&i.length&&i.forEach(e=>{o.form_fields.push({name:e.bcLabel,value:e.default})}),n.addresses=[o],n.trigger_account_created_notification=!0}const E={storeHash:Be,...n};return ut(E)},b=async(m,n,E)=>{try{const o={};o.customerId=n||"",o.storeHash=Be;const i=(d||[]).filter(a=>!!a.custom);if(i.length){const a=[];i.forEach(s=>{const M={};M.fieldName=ge(s.name),M.fieldValue=(s==null?void 0:s.default)||"",a.push(M)}),o.userExtraFields=a}const e=p.filter(a=>!a.custom&&a.fieldType!=="files"),h=p.filter(a=>!!a.custom);if(e.length&&e.forEach(a=>{o[st(ge(a.name))]=(a==null?void 0:a.default)||""}),h.length){const a=[];h.forEach(s=>{const M={};M.fieldName=ge(s.name),M.fieldValue=(s==null?void 0:s.default)||"",a.push(M)}),o.extraFields=a}const f=l.filter(a=>!a.custom)||[],F=l.filter(a=>!!a.custom)||[];if(f.length&&f.forEach(a=>{const s=ge(a.name);s==="address1"&&(o.addressLine1=a.default),s==="address2"&&(o.addressLine2=a.default),o[s]=a.default}),F.length){const a=[];F.forEach(s=>{const M={};M.fieldName=ge(s.name),M.fieldValue=(s==null?void 0:s.default)||"",a.push(M)}),o.addressExtraFields=a}return o.fileList=E,o.channelId=he,await Je(o)}catch(o){ue.error(o)}},ee=async m=>{let n=[];if(m.length){m.forEach(E=>{n=E.default});try{return(await Promise.all(n.map(u=>Qe({file:u,type:"companyAttachedFile"})))).reduce((u,i)=>{let e=u;if(i.code===200){const h={...i.data};h.fileSize=h.fileSize?"".concat(h.fileSize):"",e=[...u,h]}else throw i.data.errMsg||i.message||S("intl.global.fileUpload.fileUploadFailure");return e},[])}catch(E){throw ue.error(E),E}}},re=m=>{const n=g.map(o=>{const u=o;return x==="1"&&(u.default=m[o.name]||o.default),o}),E=U.map(o=>{const u=o;return x==="2"&&(u.default=m[o.name]||o.default),o});O({type:"all",payload:{passwordInformation:n,bcPasswordInformation:E}})},me=async()=>{if(d&&d.length>0){const m=d.find(i=>i.fieldId==="field_email_marketing_newsletter"&&i.fieldType==="checkbox"),n=d.find(i=>i.fieldId==="field_first_name")||{},E=d.find(i=>i.fieldId==="field_last_name")||{},o=(m==null?void 0:m.isChecked)||!1,u=(m==null?void 0:m.default)||[];if(o&&u.length>0)try{await mt({storeHash:Be,email:y,first_name:n.default,last_name:E.default,channel_id:he||1})}catch(i){Y((i==null?void 0:i.message)||i)}}},fe=m=>{ce(async n=>{var E,o;if(n.password!==n.confirmPassword){te("confirmPassword",{type:"manual",message:S("global.registerComplete.passwordMatchPrompt")}),te("password",{type:"manual",message:S("global.registerComplete.passwordMatchPrompt")});return}if(W&&!G){J(!0);return}if(!Z)try{O({type:"loading",payload:{isLoading:!0}});let u=!0;if(x==="2")await r(n);else{const i=p.filter(s=>s.fieldType==="files"),e=await ee(i||[]),h=await r(n),{data:f}=h,F=await b(n,f.id,e);u=+(((o=(E=F==null?void 0:F.companyCreate)==null?void 0:E.company)==null?void 0:o.companyStatus)||"")==1}O({type:"finishInfo",payload:{submitSuccess:!0,isAutoApproval:u,blockPendingAccountOrderCreation:A}}),re(n),await me(),K()}catch(u){Y((u==null?void 0:u.message)||u)}finally{O({type:"loading",payload:{isLoading:!1}})}})(m)};return t.jsxs(T,{sx:{pl:1,pr:1,mt:2,width:"100%","& h4":{color:C},"& input, & .MuiFormControl-root .MuiTextField-root":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",padding:"10px !important"}},children:[V&&t.jsx(Ee,{severity:"error",children:t.jsx(Ae,{children:V})}),t.jsxs(T,{children:[B&&t.jsxs(t.Fragment,{children:[y.length>0&&t.jsx(T,{sx:{fontSize:"16px",fontWeight:400,color:"#000000",marginBottom:"10px",marginTop:"-12px",wordWrap:"break-word",textAlign:"center"},children:"Ahora por favor crea una contraseña para tu cuenta: ".concat(y)}),t.jsx(xe,{formFields:B,errors:oe,control:ie})]}),Z?t.jsx(ke,{variant:"body1",sx:{display:"flex",alignSelf:"flex-start",marginLeft:"8px",marginTop:"2px",fontSize:"13px"},children:S("login.loginText.missingCaptcha")}):"",W?t.jsx(T,{sx:{display:"flex",justifyContent:"center",marginTop:"20px"},children:t.jsx(xt,{siteKey:k,size:"normal",handleGetKey:_})}):""]}),t.jsx(Le,{handleBack:R,activeStep:z,handleNext:fe,email:y})]})}function Bt(q){var Q,P;const{handleBack:S,handleNext:R,activeStep:z}=q,{state:K,dispatch:B}=c.useContext(Fe),I=Pe(Ve),{state:{accountLoginRegistration:V,portalStyle:{backgroundColor:Y="#FEF9F5"}}}=c.useContext(Ie),y=ye(Y),j=be(),[G]=we(),[D,W]=c.useState(""),{contactInformation:v,accountType:k,additionalInformation:$,bcContactInformation:Z,bcAdditionalInformation:J}=K,{control:_,handleSubmit:ie,getValues:ce,formState:{errors:te},setError:oe,setValue:ae}=je({mode:"onSubmit"}),O=k==="1"?"additionalInformation":"bcAdditionalInformation",A=k==="1"?$||[]:J||[],le=v==null?void 0:v.map(p=>{const L=p;return p.fieldId==="field_email"&&k==="1"&&(L.isTip=!1),p}),C=k==="1"?le:Z||[],N=k==="1"?"contactInformation":"bcContactInformationFields",w=A.length?(Q=A[0])==null?void 0:Q.groupName:"",g=(p=!1)=>{B({type:"loading",payload:{isLoading:p}})},U=p=>{B({type:"accountType",payload:{accountType:p.target.value}})},x=((P=v==null?void 0:v.find(p=>p.fieldId==="field_email"))==null?void 0:P.name)||"email",ne=async p=>{const L=k==="1";try{g(!0);const{isValid:d,userType:X,userInfo:{companyName:H=""}={}}=L?await Ft({email:p,channelId:he}):await Ct({email:p,channelId:he});return d?W(""):(W(j(rt[X],{companyName:H||"",email:p})),oe(x,{type:"custom",message:""}),I==null||I.body.scrollIntoView(!0)),d}catch(d){return!1}finally{g(!1)}},se=async p=>{ie(async L=>{var H;if(!await ne(L[x]))return;const d=C.map(l=>{const r=l;return r.default=L[l.name]||l.default,l.fieldId==="field_email_marketing_newsletter"&&l.fieldType==="checkbox"&&(r.isChecked=L[l.name].length>0),l});try{if(g(!0),k==="1"){const l=d.filter(b=>!!b.custom),r=l.map(b=>({fieldName:Ce.decode(b.name),fieldValue:L[b.name]||b.default}));if(r.length>0){const b=await ft({extraFields:r});if(b.code!==200){const ee=((H=b.data)==null?void 0:H.errMsg)||b.message||"",re=ee.split(":");if(re.length>=2){const me=l.find(fe=>Ce.decode(fe.name)===re[0]);if(me){oe(me.name,{type:"manual",message:re[1]}),g(!1);return}}W(ee),g(!1);return}}W("")}}catch(l){ue.error(l)}finally{g(!1)}let X=[];A&&(X=A.map(l=>{const r=l;return r.default=L[l.name]||l.default,l})),B({type:"all",payload:{[O]:[...X],[N]:[...d]}}),R()})(p)};return t.jsxs(T,{sx:{pl:1,pr:1,mt:2,width:"100%"},children:[D&&t.jsx(Ee,{severity:"error",children:t.jsx(Ae,{children:D})}),t.jsx(T,{component:"div",sx:{color:"#000000",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:G?"0.875rem":"1rem",textAlign:G?"center":"center ",padding:"0px 15px"},dangerouslySetInnerHTML:{__html:j("register.step.account.customText")}}),t.jsx(Ue,{sx:{"& h4":{color:y}},children:t.jsxs(He,{"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",value:k,onChange:U,sx:{display:"none","& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label":{color:pe(y,.87)},"& .MuiButtonBase-root.MuiRadio-root.MuiRadio-colorPrimary:not(.Mui-checked)":{color:pe(y,.6)}},children:[V.b2b&&t.jsx(Te,{value:"1",control:t.jsx(Re,{}),label:j("register.registeredAccount.businessAccount")}),V.b2c&&t.jsx(Te,{value:"2",control:t.jsx(Re,{}),label:j("register.registeredAccount.personalAccount")})]})}),t.jsx(T,{sx:{"& h4":{color:y},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",padding:"10px !important"},"& .MuiButtonBase-root.MuiCheckbox-root.MuiCheckbox-colorPrimary:not(.Mui-checked)":{color:pe(y,.6)},"& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label":{color:pe(y,.87)}},children:t.jsx(xe,{formFields:C,errors:te,control:_,getValues:ce,setValue:ae})}),t.jsx(T,{}),A&&A.length?t.jsxs(T,{sx:{"& h4":{color:y},"& .MuiFormControlLabel-label, & .MuiFormControl-root .MuiFormLabel-root:not(.Mui-focused)":{color:pe(y,.87)},"& .MuiRadio-root:not(.Mui-checked)":{color:pe(y,.6)}},children:[t.jsx(_e,{children:w}),t.jsx(xe,{formFields:A,errors:te,control:_,getValues:ce,setValue:ae})]}):"",t.jsx(Le,{activeStep:z,handleBack:S,handleNext:se})]})}function _t(q){var fe,m,n,E,o,u,i;const S=be(),[R]=we(),{handleBack:z,handleNext:K,activeStep:B}=q,{state:I,dispatch:V}=c.useContext(Fe),Y=()=>{window.parent.postMessage({method:"postMessageB2BRegister",data:{type:"TRACK_COMPLETE_REGISTRATION"}},"*")};c.useEffect(()=>{Y()},[]);const y=I.contactInformation||[],j=I.companyInformation||[],G=((fe=y.find(e=>e.fieldId==="field_first_name"))==null?void 0:fe.default)||"",D=((m=y.find(e=>e.fieldId==="field_last_name"))==null?void 0:m.default)||"",W="".concat(G," ").concat(D).trim(),v=j.find(e=>e.fieldId==="field_company_name");v&&(v.default=W);const k=((n=y.find(e=>e.fieldId==="field_email"))==null?void 0:n.default)||"",$=j.find(e=>e.fieldId==="field_company_email");$&&($.default=k);const Z=((E=y.find(e=>e.fieldId==="field_phone_number"))==null?void 0:E.default)||"",J=j.find(e=>e.fieldId==="field_company_phone_number");J&&(J.default=Z);const _=((o=y.find(e=>e.label==="Cédula profesional"))==null?void 0:o.default)||"",ie=j.find(e=>e.label==="Cédula profesional");ie&&(ie.default=_),console.log(j);const{state:{portalStyle:{backgroundColor:ce="#FEF9F5"}}}=c.useContext(Ie),te=ye(ce),[oe,ae]=c.useState(""),{accountType:O="1",companyInformation:A=[],companyAttachment:le=[],addressBasicFields:C=[],bcAddressBasicFields:N=[],countryList:w=[]}=I,{control:g,handleSubmit:U,getValues:x,formState:{errors:ne},setValue:se,watch:Q,setError:P}=je({mode:"all"}),p=O==="1"?(u=A[0])==null?void 0:u.groupName:"",L=O==="1"?"addressBasicFields":"bcAddressBasicFields",d=O==="1"?C:N,X=((i=d[0])==null?void 0:i.groupName)||"",H=c.useCallback((e,h="")=>{var a;const f=((a=w.find(s=>s.countryCode===e||s.countryName===e))==null?void 0:a.states)||[],F=d.find(s=>s.name==="state");F&&(f.length>0?(F.fieldType="dropdown",F.options=f):(F.fieldType="text",F.options=[])),se("state",h&&e&&(f.find(s=>s.stateName===h)||f.length===0)?h:""),V({type:"stateList",payload:{stateList:f,addressBasicFields:C,bcAddressBasicFields:N,[L]:[...d]}})},[C,d,L,N,w]);c.useEffect(()=>{const e=x("country"),h=x("state");H(e,h)},[]),c.useEffect(()=>{const e=Q((h,{name:f,type:F})=>{const{country:a,state:s}=h;f==="country"&&F==="change"&&H(a,s)});return()=>e.unsubscribe()},[w,H]);const l=(e=!1)=>{V({type:"loading",payload:{isLoading:e}})},r=(e,h)=>e.map(f=>{const F=f;return F.default=h[f.name]||f.default,f}),b=()=>{const e=[...A,...le,...d].reduce((a,s)=>{const M=a;return M[s.name]=x(s.name)||s.default,a},{}),h=r(A,e),f=r(le,e),F=r(d,e);V({type:"all",payload:{companyInformation:[...h],companyAttachment:[...f],[L]:[...F]}})},ee=()=>{var e;if(O==="1"){const h=x(),f=A.find(F=>F.fieldId==="field_attachments");if(!It(f)&&f.required&&h[f.name].length===0)return P(f.name,{type:"required",message:S("global.validate.required",{label:(e=f.label)!=null?e:""})}),l(!1),!0}return!1},re=e=>{const h=ee();U(async f=>{var F;if(!h){l(!0);try{if(O==="1"){const a=A.filter(de=>!!de.custom),s=a.map(de=>({fieldName:Ce.decode(de.name),fieldValue:f[de.name]||de.default})),M=await pt({extraFields:s});if(M.code!==200){const de=((F=M.data)==null?void 0:F.errMsg)||M.message||"",Se=de.split(":");if(Se.length>=2){const Me=a.find(ze=>Ce.decode(ze.name)===Se[0]);if(Me){P(Me.name,{type:"manual",message:Se[1]}),l(!1);return}}ae(de),l(!1);return}ae("")}b(),l(!1),K()}catch(a){l(!1)}}})(e)},me=()=>{b(),z()};return t.jsxs(T,{sx:{pl:1,pr:1,mt:2,width:"100%","& h4":{color:te},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiDropzoneArea-textContainer, & .MuiSelect-select.MuiSelect-outlined, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",padding:"10px !important"}},children:[oe&&t.jsx(Ee,{severity:"error",children:t.jsx(Ae,{children:oe})}),t.jsx(T,{component:"div",sx:{color:"#000000",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:R?"0.875rem":"1rem",textAlign:R?"center":"center ",padding:"0px 15px"},dangerouslySetInnerHTML:{__html:S("register.step.details.customText")}}),O==="1"?t.jsxs(T,{sx:{display:"none !important"},children:[t.jsx(_e,{children:p}),t.jsx(xe,{formFields:[...A],errors:ne,control:g,getValues:x,setValue:se,setError:P})]}):null,t.jsxs(T,{children:[t.jsx(_e,{children:X}),t.jsx(xe,{formFields:d,errors:ne,control:g,getValues:x,setValue:se})]}),t.jsx(Le,{handleBack:me,handleNext:re,activeStep:B})]})}const Et=dt(T)({"& #b3-customForm-id-name":{'& label[data-shrink="true"]':{whiteSpace:"break-spaces",transition:"unset",background:"white"},'& label[data-shrink="false"]':{whiteSpace:"break-spaces",color:"#474747",fontFamily:"Montserrat",fontSize:"0.9375rem",fontStyle:"normal",fontWeight:400,lineHeight:"normal",top:"-4px",background:"white"}}});function jt(q){const{activeStep:S,handleBack:R,handleNext:z,handleFinish:K}=q,B=I=>{switch(I){case 0:return t.jsx(Bt,{activeStep:S,handleBack:R,handleNext:z});case 1:return t.jsx(_t,{activeStep:S,handleBack:R,handleNext:z});case 2:return t.jsx(St,{activeStep:S,handleBack:R,handleNext:z});case 3:return t.jsx(gt,{activeStep:S,handleFinish:K});default:return null}};return t.jsx(Et,{component:"div",children:B(S)})}function At(q){const{children:S,isStepOptional:R,activeStep:z,backgroundColor:K}=q,B=be(),[I]=we(),V=Ke(),{state:Y}=c.useContext(Fe),{accountType:y,submitSuccess:j,isAutoApproval:G}=Y,D=Oe.get("blockPendingAccountOrderCreation")&&!G,W=B(D?"register.title.registerCompleteWarning":"register.title.registerComplete"),v=y==="1"?W:B("register.title.accountCreated"),k=ye(K);return t.jsxs(T,{component:"div",sx:{borderRadius:"4px",marginTop:"3px",background:"#FFFFFF",width:"100%",padding:I?"0 20px":"0 20%"},children:[t.jsx(T,{component:"h3",sx:{color:"#474747",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:I?"1.625rem":"2.5rem",textAlign:I?"center":"center "},children:j?v:B("register.title.accountRegister")}),!j&&t.jsx(We,{activeStep:z,sx:{display:"none","& .MuiSvgIcon-root:not(.Mui-active) .MuiStepIcon-text":{fill:ye(k)},"& .MuiSvgIcon-root.Mui-active .MuiStepIcon-text":{fill:ye(V.palette.primary.main)}},children:it.map(($,Z)=>{const J={},_={};return R(Z)&&(_.optional=t.jsx(ke,{variant:"caption",children:B("register.step.optional")})),t.jsx(Ge,{...J,children:t.jsx(qe,{..._,children:B($)})},$)})}),S]})}const Lt=[1,2];function so(q){const{setOpenPage:S}=q,[R,z]=c.useState(0),K=be(),[B]=we(),I=wt(),V=Pe(Ve),{state:{isCheckout:Y,isCloseGotoBCHome:y,logo:j,storeName:G,registerEnabled:D}}=c.useContext(Ne),{state:{isLoading:W,accountType:v,contactInformation:k=[],passwordInformation:$=[],bcPasswordInformation:Z=[],bcContactInformation:J=[]},dispatch:_}=c.useContext(Fe),{state:{accountLoginRegistration:ie,portalStyle:{backgroundColor:ce="#FEF9F5"}}}=c.useContext(Ie);c.useEffect(()=>{D||I("/login")},[D]),c.useEffect(()=>{(async()=>{var N,w,g,U;try{_&&(_({type:"loading",payload:{isLoading:!0}}),_({type:"finishInfo",payload:{submitSuccess:!1}}));const x=Lt.map(r=>Ze(r)),ne=await Promise.all(x),se=(((N=ne[1])==null?void 0:N.accountFormFields)||[]).map(r=>{const b=r;return ct.includes((r==null?void 0:r.fieldId)||"")&&r.groupId===4&&(b.isRequired=!0,b.visible=!0),r}),Q=ve(((w=ne[0])==null?void 0:w.accountFormFields)||[]),P=ve(se||[]),{countries:p}=await et(),L=((g=P.address)==null?void 0:g.map(r=>{const b=r;return r.name==="country"&&(b.options=p,b.replaceOptions={label:"countryName",value:"countryName"}),r}))||[],d=((U=Q.address)==null?void 0:U.map(r=>{const b=r;if(r.name==="country"){b.options=p;const ee=p.find(re=>re.countryName===r.default);b.default=(ee==null?void 0:ee.countryCode)||r.default}return r}))||[],{b2b:X,b2c:H}=ie;_&&_({type:"all",payload:{accountType:H&&!X?"2":"1",isLoading:!1,storeName:G,contactInformation:[...P.contactInformation||[]],bcContactInformation:[...Q.contactInformation||[]],additionalInformation:[...P.additionalInformation||[]],bcAdditionalInformation:[...Q.additionalInformation||[]],companyExtraFields:[],companyInformation:[...(P==null?void 0:P.businessDetails)||[]],companyAttachment:[...lt(K)],addressBasicFields:[...L],bcAddressBasicFields:[...d],countryList:[...p],passwordInformation:[...P.password||[]],bcPasswordInformation:[...Q.password||[]]}})}catch(x){ue.error(x)}})()},[]);const te=C=>C===-1,oe=()=>{var w,g;const C=((w=(v==="1"?k:J).find(U=>U.name==="email"))==null?void 0:w.default)||"",N=((g=(v==="1"?$:Z).find(U=>U.name==="password"))==null?void 0:g.default)||"";return{emailAddress:C,password:N}},ae=async()=>{z(C=>C+1)},O=()=>{z(C=>C-1)},A=()=>{_&&_({type:"all",payload:{accountType:"",isLoading:!1,storeName:"",submitSuccess:!1,contactInformation:[],additionalInformation:[],companyExtraFields:[],companyInformation:[],companyAttachment:[],addressBasicFields:[],addressExtraFields:[],countryList:[],passwordInformation:[]}})},le=async()=>{var N;_({type:"loading",payload:{isLoading:!0}});const C=oe();if(Y)try{await nt(C),window.location.reload()}catch(w){ue.error(w)}else try{const w={email:C.emailAddress,pass:C.password},{data:g}=await at(w);if((N=g==null?void 0:g.login)!=null&&N.customer&&Oe.set("loginCustomer",{emailAddress:g.login.customer.email,phoneNumber:g.login.customer.phone,...g.login.customer}),await tt(),A(),!ot(I))return;y?window.location.href="/":I("/orders")}catch(w){ue.error(w)}_({type:"loading",payload:{isLoading:!1}})};return c.useEffect(()=>{V==null||V.body.scrollIntoView(!0)},[R]),Xe(!1),t.jsx($e,{setOpenPage:S,children:t.jsx(ht,{isMobile:B,children:t.jsx(Ye,{isSpinning:W,tip:K("global.tips.loading"),transparency:"0",children:t.jsxs(T,{sx:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center"},children:[j&&t.jsx(yt,{children:t.jsx(De,{sx:{maxWidth:"250px"},onClick:()=>{window.location.href="/"},children:t.jsx("img",{src:"".concat(j),alt:K("global.tips.registerLogo"),loading:"lazy"})})}),t.jsx(At,{activeStep:R,isStepOptional:te,backgroundColor:ce,children:t.jsx(jt,{activeStep:R,handleBack:O,handleNext:ae,handleFinish:le})})]})})})})}export{so as default};
