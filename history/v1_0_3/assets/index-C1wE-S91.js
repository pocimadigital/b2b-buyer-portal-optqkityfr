import{j as e,B as s,y as fe,a0 as E,I as he,T as ye}from"./mui-CyG7s_nf.js";import{r as y}from"./reactVendor-BAhb8EbJ.js";import{u as be,d as we}from"./router-BbCjXwHs.js";import{u as J}from"./lang-DxTEvHWx.js";import{B as Te}from"./B3Card-CJeF0OZ7.js";import{a3 as N,a as _,i as G,u as L,ar as Fe,G as Ce,C as Le,as as je,a2 as Ie,n as Be,o as Se,a5 as U,at as Ae,au as Pe,av as Re,aw as He,a8 as ve,a6 as ke,w as Me,ag as De,ax as qe,ay as Ee,x as Ue,az as O,aa as W,aA as Oe,aB as We}from"./react-setup-9NPp_6Sq.js";import{b as ze}from"./b3Logger-CMQiGC3f.js";import"../index.CMPJ-jXT.js";import{l as Je}from"./b3Login-BpQA0__3.js";import{b as z,a as Ne}from"./login-Dt1kfEFf.js";import{a as _e,l as Ge}from"./config-Bu4V7E9v.js";import{u as Ve}from"./form-Bvi8lP6x.js";import{B as Qe}from"./B3CustomForm-BEMu6QY4.js";import{a as Ye,L as $e}from"./styled-HeAq0rir.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./eStyled-B3rIBjaz.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./lodashEs-Ck10JMnh.js";import"./muiIcon-BfPleEzf.js";import"./dateFns-BB2kaHor.js";import"./dropzone-D4lSiSJA.js";import"./validatorRules-Qy5XGE5E.js";function H(a){const{html:l,sx:d}=a;return e.jsx(s,{sx:{...d},dangerouslySetInnerHTML:{__html:l}})}function Ke(a){const{loginBtn:l,handleLoginSubmit:d,gotoForgotPassword:x}=a,g=J(),{control:p,handleSubmit:c,getValues:S,formState:{errors:f},setValue:o}=Ve({mode:"onSubmit"}),j=w=>{d(w)},A=_e(g,c(j));return e.jsx(s,{sx:{display:"flex",flexDirection:"column"},children:e.jsx(s,{sx:{width:"100%","& input":{bgcolor:"#F5F5F5",borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"}},children:e.jsxs("form",{onSubmit:c(j),children:[e.jsx(Qe,{formFields:A,errors:f,control:p,getValues:S,setValue:o}),e.jsxs(s,{sx:{display:"flex",justifyContent:"flex-start ",alignItems:"center",mt:2},children:[e.jsx(N,{type:"submit",variant:"contained",sx:{borderRadius:"3.125rem",background:"#1B5F90",border:"1px solid #1B5F90",color:"#FFFFFF",textAlign:"center",fontFamily:"Montserrat",fontSize:"1rem",fontStyle:"normal",fontWeight:400,lineHeight:"normal",textTransform:"capitalize",letterSpacing:"0.02rem",padding:"0.7rem 1.75rem",":hover":{background:"#FFFFFF",color:"#1B5F90"}},children:l}),e.jsx(s,{sx:{cursor:"pointer",ml:2,textUnderlineOffset:"4px",color:"#474747",textAlign:"center",fontFamily:"Montserrat",fontSize:"0.9375rem",fontStyle:"normal",fontWeight:400,lineHeight:"normal"},onClick:()=>x(),children:g("login.loginText.forgotPasswordText")})]})]})})})}function Xe(a){const{handleSubmit:l,widgetBodyText:d,createAccountButtonText:x}=a,g=fe(),[p]=_();return e.jsxs(s,{sx:{padding:p?"16px":"20px",borderRadius:"4px",mt:p?"0":"-25px"},children:[e.jsx(H,{sx:{minHeight:"250px","& .panel":{".panel-title":{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",fontWeight:400,fontSize:"24px"}}},html:d}),e.jsx(s,{sx:{marginTop:"5px"},children:e.jsx(N,{type:"submit",onClick:l,variant:"contained",sx:{ml:p?0:1,backgroundColor:g.palette.primary.main},children:x})})]})}const Ze=()=>{const a=L(({b2bFeatures:c})=>c.masqueradeCompany.isAgenting),l=L(({company:c})=>c.customer.b2bId),d=L(({b2bFeatures:c})=>c.masqueradeCompany.id),x=G(),g=a&&typeof l=="number";return{endMasquerade:y.useCallback(async()=>{g&&(await Be(+d,l),x(Se()))},[l,g,d,x]),isMasquerade:g}},et=a=>{if(a)switch(a){case"1":return"error";case"4":return"error";case"5":return"warning";default:return"success"}};function It(a){const{isMasquerade:l,endMasquerade:d}=Ze(),{setOpenPage:x}=a,g=G(),p=L(Fe),c=L(({quoteInfo:i})=>i.quoteDetailToCheckoutUrl),[S,f]=y.useState(!0),[o]=_(),[j,A]=y.useState(!0),[w,I]=y.useState(""),[T,V]=y.useState({emailAddress:"",password:""}),b=be(),n=J(),[P,Q]=we(),{state:{isCheckout:Y,logo:$,registerEnabled:F}}=y.useContext(Ce),{state:{loginPageButton:K,loginPageDisplay:X,loginPageHtml:Z,portalStyle:{backgroundColor:ee="FEF9F5"}}}=y.useContext(Le),{createAccountButtonText:te,primaryButtonColor:oe,signInButtonText:ne}=K,{displayStoreLogo:se,pageTitle:ie}=X,{bottomHtmlRegionEnabled:re,bottomHtmlRegionHtml:ae,createAccountPanelHtml:le,topHtmlRegionEnabled:ce,topHtmlRegionHtml:de}=Z,u={loginTitle:ie||n("login.button.signIn"),loginBtn:ne||n("login.button.signInUppercase"),createAccountButtonText:te||n("login.button.createAccount"),btnColor:oe||"",widgetHeadText:ce?de:void 0,widgetBodyText:le||je,widgetFooterText:re?ae:void 0,logo:se?$:void 0};y.useEffect(()=>{(async()=>{var r;try{const h=P.get("loginFlag"),R=P.get("showTip")!=="false";if(A(R),h&&I(h),h==="7"&&U.error(n("login.loginText.invoiceErrorTip")),h==="3"&&p){const B=await Ae();if((r=B.data.site.cart)!=null&&r.entityId){const M=Pe(B.data.site.cart.entityId);await Re(M)}const m=await z();m.errors&&console.log("LOGOUT INVALIDO: ".concat(m.errors[0].message));const{result:t}=(await z()).data.logout;if(t!=="success")return;l&&await d(),window.sessionStorage.clear(),He(),f(!1),window.location.reload();return}f(!1)}finally{f(!1)}})()},[n,d,p,l,P]);const v=(i,r="")=>{if(!i)return"";switch(i){case"1":return n("login.loginTipInfo.resetPassword",{email:r});case"2":return n("login.loginTipInfo.receivePassword");case"3":return n("login.loginTipInfo.loggedOutLogin");case"4":return n("login.loginTipInfo.accountincorrect");case"5":return n("login.loginTipInfo.accountPrelaunch");case"6":return n("login.loginText.deviceCrowdingLogIn");default:return""}},k=async i=>{const r=await We(i);I(r?"1":"4")},ge=async i=>{if(f(!0),V(i),Q(r=>(r.delete("loginFlag"),r)),Y)try{await Ge(i),window.location.reload()}catch(r){ze.error(r),k(i.emailAddress)}else try{const r={email:i.emailAddress,password:i.password,storeHash:ve,channelId:ke},{login:{result:{token:h,storefrontLoginToken:R,permissions:B},errors:m}}=await Ne({loginData:r});if(g(Me(h)),De.dispatch(qe(B)),Ee(R),m!=null&&m[0]||!h){if(m!=null&&m[0]){const{message:t}=m[0];if(t==="Operation cannot be performed as the storefront channel is not live"){I("5"),f(!1);return}}k(i.emailAddress)}else{const t=await Ue(h);if(c){b(c);return}if((t==null?void 0:t.userType)===O.MULTIPLE_B2C&&(t==null?void 0:t.role)===W.SUPER_ADMIN){b("/dashboard");return}if(!Je(b))return;const{getShoppingListPermission:D,getOrderPermission:q}=Oe();if((t==null?void 0:t.role)===W.JUNIOR_BUYER&&(t==null?void 0:t.companyRoleName)==="Junior Buyer")b(D?"/shoppingLists":"/accountSettings");else{let C=q?"/orders":"/shoppingLists";C=D||q?C:"/accountSettings",C=(t==null?void 0:t.userType)===O.B2C?"/orders":C,b(C)}}}catch(r){U.error(n("login.loginTipInfo.accountincorrect"))}finally{f(!1)}},ue=()=>{b("/register")},me=()=>{b("/forgotpassword")},pe=F?"100%":"50%",xe=F?"50%":"auto";return e.jsx(Te,{setOpenPage:x,children:e.jsx(Ye,{paddings:o?"0":"20px 20px",children:e.jsx(Ie,{isSpinning:S,tip:n("global.tips.loading"),background:"transparent",children:e.jsx(s,{sx:{display:"flex",flexDirection:"column",width:"100%",minHeight:"400px",minWidth:"343px"},children:u&&e.jsxs(e.Fragment,{children:[c&&e.jsx(E,{severity:"error",variant:"outlined",children:n("login.loginText.quoteDetailToCheckoutUrl")}),u.logo&&e.jsx(s,{sx:{margin:"20px 0",minHeight:"150px"},children:e.jsx($e,{children:e.jsx(he,{sx:{maxWidth:o?"70%":"250px"},onClick:()=>{window.location.href="/"},children:e.jsx("img",{src:u.logo,alt:n("login.registerLogo"),loading:"lazy"})})})}),w&&j&&e.jsx(s,{sx:{padding:o?0:"0 5%",margin:"10px 0 0 0"},children:v(w,T==null?void 0:T.emailAddress)&&e.jsx(E,{severity:et(w),variant:"outlined",children:v(w,(T==null?void 0:T.emailAddress)||"")})}),u.widgetHeadText&&e.jsx(H,{sx:{minHeight:"48px",width:F||o?"100%":"50%"},html:u.widgetHeadText}),e.jsxs(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[e.jsx(ye,{variant:"h2",sx:{margin:"2rem 0",display:"flex",justifyContent:"center",alignItems:"center",color:"#474747",fontFamily:"Montserrat",fontStyle:"normal",fontWeight:400,lineHeight:"normal",fontSize:o?"1.625rem":"2.5rem",textAlign:o?"center":"initial"},children:n("login.loginText.signInHeader")}),e.jsx(s,{sx:{bgcolor:"#FFFFFF",borderRadius:"4px",margin:"20px 0",display:"flex",flexDirection:"column",justifyContent:"center",width:o?"auto":pe},children:e.jsxs(s,{sx:{mb:"20px",display:"flex",flexDirection:o?"column":"row",justifyContent:"center",alignItems:"center",padding:"0 40px",width:o?"auto":"100%",gap:o?"20px":"0"},children:[e.jsx(s,{sx:{width:o?"auto":xe,paddingRight:o?0:"2%",ml:"16px",mr:o?"16px":"",pb:F?"":"36px"},children:e.jsx(Ke,{loginBtn:u.loginBtn,gotoForgotPassword:me,handleLoginSubmit:ge,backgroundColor:ee})}),F&&e.jsx(s,{sx:{flex:"1",background:"#F6F6F6",borderRadius:"0.625rem",padding:o?"1rem 1.5rem 1rem 1.5rem":"1rem 3rem 2rem 3rem"},children:e.jsx(Xe,{createAccountButtonText:u.createAccountButtonText,widgetBodyText:u.widgetBodyText,handleSubmit:ue})})]})})]}),u.widgetFooterText&&e.jsx(H,{sx:{minHeight:"48px",width:F||o?"100%":"50%"},html:u.widgetFooterText})]})})})})})}export{It as default};
