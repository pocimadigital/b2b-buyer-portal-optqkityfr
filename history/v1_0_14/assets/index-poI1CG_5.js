import{j as t,o as rt,T as Z,B as C,K as pt,ab as ct,q as N}from"./mui-CyG7s_nf.js";import{r as a}from"./reactVendor-BAhb8EbJ.js";import{u as U}from"./lang-DxTEvHWx.js";import{u as b,R as W,_ as Q,aZ as lt,a_ as dt,bK as ut,bL as ht,a6 as H,bM as mt,bN as ft,a5 as Y,r as gt,aA as xt,ak as Lt,a3 as St,a as Ct,G as bt,p as Bt,a2 as yt,ab as jt,bp as vt,a$ as kt,b0 as wt,bO as Et,bP as Ft}from"./react-setup-DNiVtwmK.js";import{B as Pt}from"./B3Filter-DFg1rxRy.js";import"../index._cUIRZek.js";import{d as It,a as At,u as Ot}from"./EditOutlined-CqjxSzSp.js";import{u as Rt}from"./form-Bvi8lP6x.js";import{B as zt}from"./B3CustomForm-DgkYOiJI.js";import{g as Dt,S as Tt,a as _t}from"./ShoppingStatus-JkrFymi_.js";import{n as V}from"./eStyled-B3rIBjaz.js";import{d as qt}from"./DeleteOutlined-DvM66JMT.js";import{i as Nt}from"./lodashEs-Ck10JMnh.js";import{u as Mt}from"./router-BbCjXwHs.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./muiIcon-BfPleEzf.js";import"./dateFns-BB2kaHor.js";import"./dropzone-D4lSiSJA.js";import"./b3Logger-CMQiGC3f.js";import"./B3FilterMore-Ba_a_vDZ.js";import"./B3FilterSearch-o7ogqBWY.js";function $t({renderList:E,isB2BUser:s},F){const B=b(W),[u,y]=a.useState(!1),[p,m]=a.useState(""),[o,j]=a.useState(null),[c,f]=a.useState(!1),[g,P]=a.useState([]),i=U(),{control:I,handleSubmit:v,getValues:n,formState:{errors:k},clearErrors:A,setValue:l}=Rt({mode:"onSubmit"});a.useEffect(()=>{u&&p!=="add"&&o&&g.forEach(h=>{l(h.name,o[h.name])})},[o,u,l,p,g]);const x=()=>{g.forEach(h=>{l(h.name,"")}),A(),y(!1)},D=()=>{v(async h=>{f(!0);try{const d={...h};let L=s?lt:dt,O=i("shoppingLists.addSuccess");if(p==="edit")s?(L=ut,d.status=o==null?void 0:o.status):(L=ht,d.channelId=H),d.id=(o==null?void 0:o.id)||0,O=i("shoppingLists.updateSuccess");else if(p==="dup")L=s?mt:ft,d.sampleShoppingListId=(o==null?void 0:o.id)||0,O=i("shoppingLists.duplicateSuccess");else if(p==="add")if(s){const{submitShoppingListPermission:T}=B;d.status=T?30:0}else d.channelId=H;await L(d),x(),Y.success(O),E()}finally{f(!1)}})()},z=(h,d)=>{const L=Dt(i);P(L),d&&j(d),m(h),y(!0)};a.useImperativeHandle(F,()=>({handleOpenAddEditShoppingListsClick:z}));const w=()=>i(p==="edit"?"shoppingLists.edit":p==="add"?"shoppingLists.createNewShoppingList":"shoppingLists.duplicateShoppingList");return t.jsx(Q,{isOpen:u,title:w(),leftSizeBtn:i("shoppingLists.cancel"),rightSizeBtn:i("shoppingLists.save"),handleLeftClick:x,handRightClick:D,loading:c,children:t.jsx(zt,{formFields:g,errors:k,control:I,getValues:n,setValue:l})})}const Ht=a.forwardRef($t);var G={},Ut=rt;Object.defineProperty(G,"__esModule",{value:!0});var tt=G.default=void 0,Wt=Ut(gt()),Vt=t;tt=G.default=(0,Wt.default)((0,Vt.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");const Gt=V("div")(()=>({display:"flex",alignItems:"center",justifyContent:"space-between"})),M=V(Z)(()=>({fontWeight:"500",paddingRight:"5px",color:"#000000"})),$=V(C)(()=>({display:"flex",alignItems:"center",justifyContent:"start"}));function Jt(E){const{item:s,onEdit:F,onDelete:B,onCopy:u,isPermissions:y,isB2BUser:p}=E,m=U(),[o,j]=a.useState(!0),c=b(({company:n})=>n.permissions),{submitShoppingListPermission:f,approveShoppingListPermission:g}=b(W),P=n=>f?!(n===30||n===0):n===40,i=n=>f?!(n===20||n===30):!1,I=Mt(),v=n=>I("/shoppingList/".concat(n.id),{state:{from:"shoppingList"}});return a.useEffect(()=>{if(p){const n=c.find(l=>l.code==="deplicate_shopping_list"),k=[];if(n&&!Nt(n)){const l=n.permissionLevel,x=(s==null?void 0:s.isOwner)||!1;k.push({permissionType:"shoppingListActionsPermission",permissionLevel:l===1&&x?l:2})}const{shoppingListActionsPermission:A}=xt(k);j(A)}},[s,p]),t.jsx(pt,{sx:{"& .b2b-card-content":{paddingBottom:"16px",minHeight:"300px",display:"flex",flexDirection:"column",justifyContent:"space-between",backgroundColor:"#FAFAFA",position:"relative",paddingTop:"45px"}},children:t.jsxs(ct,{className:"b2b-card-content",sx:{color:"#313440"},children:[t.jsx(Z,{variant:"h5",sx:{color:"rgba(0, 0, 0)",wordBreak:"break-all",position:"absolute",top:"10px",lineHeight:"26px",width:"88%",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:s.name}),t.jsxs(C,{sx:{pt:"20px",pb:"20px"},children:[p&&(f||g&&s.approvedFlag)&&t.jsx(C,{sx:{pb:"25px"},children:t.jsx(Tt,{status:s.status})}),t.jsx(C,{sx:{width:"100%",lineHeight:"22px",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",marginTop:"5px"},children:s.description}),p&&t.jsxs($,{children:[t.jsx(M,{children:m("shoppingLists.card.createdBy")}),s.customerInfo.firstName," ",s.customerInfo.lastName]}),t.jsxs($,{children:[t.jsx(M,{children:m("shoppingLists.card.products")}),s.products.totalCount]}),t.jsxs($,{children:[t.jsx(M,{children:m("shoppingLists.card.lastActivity")}),"".concat(Lt(s.updatedAt))]})]}),t.jsxs(Gt,{children:[t.jsx(St,{sx:{m:"0 0 0 -8px",minWidth:0,padding:"10px !important",justifyContent:"start",backgroundColor:"transparent !important",color:"#EA617C !important",textTransform:"uppercase !important",border:"none !important"},variant:"text",onClick:()=>v(s),children:m("shoppingLists.card.view")}),t.jsxs(C,{sx:{display:"".concat(y?"block":"none")},children:[!P(s.status)&&o&&t.jsx(N,{"aria-label":"edit",size:"medium",sx:{marginRight:"8px"},onClick:()=>{F(s)},children:t.jsx(It,{fontSize:"inherit"})}),t.jsx(N,{"aria-label":"duplicate",size:"medium",sx:{marginRight:"8px"},onClick:()=>{u(s)},children:t.jsx(tt,{fontSize:"inherit"})}),!i(s.status)&&o&&t.jsx(N,{"aria-label":"delete",size:"medium",onClick:()=>{B(s)},children:t.jsx(qt,{fontSize:"inherit"})})]})]})]})},s.id)}function Ce(){const[E,s]=a.useState(!1),[F,B]=a.useState(!1),[u,y]=a.useState(null),[p,m]=a.useState([]),[o]=Ct(),[j]=At(),c=U(),f=b(({b2bFeatures:e})=>e.masqueradeCompany.id),{state:{openAPPParams:g},dispatch:P}=a.useContext(bt),i=b(Bt),I=b(({company:e})=>e.companyInfo.id),{shoppingListActionsPermission:v,submitShoppingListPermission:n}=b(W);a.useEffect(()=>{(async()=>{const r=I||f;let S={};i&&(S=await vt(+r,1));const _=_t(S,n),K=JSON.parse(JSON.stringify(_));K.forEach(R=>{var X;const ot=R;return ot.label=c(R.idLang),R.name==="status"&&((X=R.options)==null||X.map(q=>{const at=q;return at.label=c(q.idLang),q})),R}),m(K)})(),g.shoppingListBtn&&P({type:"common",payload:{openAPPParams:{quoteBtn:"",shoppingListBtn:""}}})},[]);const k=Ot(),A={isEnabled:i?v:!0,customLabel:c("shoppingLists.createNew"),customButtomStyle:{fontSize:"15px",fontWeight:"500",width:"140px",padding:"0"}},l=n?"":[0,40],x={search:"",createdBy:"",status:l,isDefault:!0},[D,z]=a.useState(x),w=a.useRef(null),h=()=>{var e;(e=j.current)==null||e.refresh()},d=(e,r)=>{if(e==="search"){const S={...x,search:r};z(S)}},L=e=>{const{status:r}=e,S=r===""||r===99?l:r,_={...x,createdBy:e.createdBy,status:S,isDefault:r===""};z(_)},O=async e=>{const{edges:r,totalCount:S}=i?await kt(e):await wt({offset:e.offset,first:e.first,search:e.search,channelId:H});return{edges:r,totalCount:S}},T=()=>{var e;(e=w.current)==null||e.handleOpenAddEditShoppingListsClick("add")},et=e=>{var r;(r=w.current)==null||r.handleOpenAddEditShoppingListsClick("edit",e)},st=e=>{var r;(r=w.current)==null||r.handleOpenAddEditShoppingListsClick("dup",e)},it=e=>{y(e),B(!0)},J=()=>{B(!1)},nt=async()=>{if(u)try{s(!0),J();const e=(u==null?void 0:u.id)||0;i?await Et(e):await Ft(e),Y.success(c("shoppingLists.deleteSuccess"))}finally{s(!1),h()}};return t.jsx(yt,{isSpinning:E,children:t.jsxs(C,{sx:{display:"flex",flexDirection:"column",flex:1},children:[t.jsx(Pt,{showB3FilterMoreIcon:i,fiterMoreInfo:p,handleChange:d,handleFilterChange:L,customButtomConfig:A,handleFilterCustomButtomClick:T}),t.jsx(jt,{columnItems:[],ref:j,rowsPerPageOptions:[12,24,36],getRequestList:O,searchParams:D,isCustomRender:!0,itemXs:k?3:4,requestLoading:s,renderItem:e=>t.jsx(Jt,{item:e,isPermissions:i?v:!0,onEdit:et,onDelete:it,onCopy:st,isB2BUser:i},e.id||"")}),t.jsx(Ht,{renderList:h,ref:w,isB2BUser:i}),t.jsx(Q,{isOpen:F,title:c("shoppingLists.deleteShoppingList"),leftSizeBtn:c("shoppingLists.cancel"),rightSizeBtn:c("shoppingLists.delete"),handleLeftClick:J,handRightClick:nt,row:u,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:t.jsx(C,{sx:{display:"flex",justifyContent:"".concat(o?"center%":"start"),width:"".concat(o?"100%":"450px"),height:"100%"},children:c("shoppingLists.confirmDelete")})})]})})}export{Ce as default};
